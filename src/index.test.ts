import { describe, expect, test } from 'vitest';

import parse from './';

describe('ebics parser', () => {
  test('no transactions A', () => {
    const text = `0130012    00071EUR2 00010139479  280323                                                  0000003445691I
0730012    00071EUR2 00010139479  290323                                                  0000003445691I`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('no transactions B', () => {
    const text = `0130012    00823EUR2 00010738652  280323                                                  0000000008653O
0730012    00823EUR2 00010738652  290323                                                  0000000008653O`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('malformed - no footer  unknown line qualifier 03', () => {
    const text = `0118020 00001EUR2 00410GXLT01
030323 0000000000000} 0418020648900001EUR2 00410GXLT0191030323 030323RESTITUTION FONDS DE GARANTIE 2015123 00000000392067I000001
0518020648900001EUR2 00410GXLT0191030323 030323
0418020210400001EUR2 00410GXLT0191030323 030323FACTURE 86013179 NON GARANTIE 2014995 00000000006000{000001
0518020210400001EUR2 00410GXLT0191030323 030323DEVENANT FINANCABLE NON GARANTI
0418020404100001EUR2 00410GXLT0121030323 010323VIREMENT BANCAIRE EN VOTRE FAVE 1994254 00000001463361O000070
0518020404100001EUR2 00410GXLT0121030323 010323URN 5292443 VIREMENT N 52924
0418020302600001EUR2 00410GXLT0161030323 010323PRECOMPTE DE COMM. DE FINANCEME 1994254 00000000011488J000001
0518020302600001EUR2 00410GXLT0161030323 010323NT VIREMENT N 5292443 0418020101100001EUR2 00410GXLT0191030323 030323REPRISE DE FACTURES INDISPONIBL 1993288 00000000381110R000004
0518020101100001EUR2 00410GXLT0191030323 030323ES REMISE N 2717960 0418020303100001EUR2 00410GXLT0167030323 030323TVA SUR COMMISSION D AFFACTURAG 1993288 00000000000590}000003
0518020303100001EUR2 00410GXLT0167030323 030323E SUR REMISE N 2717960 0418020302100001EUR2 00410GXLT0165030323 030323COMMISSION D AFFACTURAGE SUR RE 1993288 00000000002950K000002
0518020302100001EUR2 00410GXLT0165030323 030323MISE N 2717960 0418020100100001EUR2 00410GXLT0191030323 030323ACHAT REMISE DE FACTURES REMIS 1993288 00000001966800{000001
0518020100100001EUR2 00410GXLT0191030323 030323E N 2717960 0418020353600001EUR2 00410GXLT0167020323 010323TVA SUR COMM. DE FINANCEMENT CO 1974131 00000000002523O000002
0518020353600001EUR2 00410GXLT0167020323 010323MPLEMENTAIRE ARRETES DE LA PERI
0418020352600001EUR2 00410GXLT0161020323 010323COMM. DE FINANCEMENT COMPLEMENT 1974131 00000000012617R000001
0518020352600001EUR2 00410GXLT0161020323 010323AIRE ARRETES DE LA PERIODE 2023
041802036BZ00001EUR2 00410GXLT01 010323 010323TVA SUR FRAIS DE GESTION DE CON 1891950 00000000000130}000002
051802036BZ00001EUR2 00410GXLT01 010323 010323TRAT EN LIGNE 041802032BZ00001EUR2 00410GXLT01 010323 010323FRAIS DE GESTION DE CONTRAT EN 1891950 00000000000650}000001
051802032BZ00001EUR2 00410GXLT01 010323 010323LIGNE 0418020312200001EUR2 00410GXLT0167280223 280223TVA SUR COMMISSION SUR REMISE D 1851684 00000000000026P000003
0518020312200001EUR2 00410GXLT0167280223 280223 AVOIRS REMISE N 2715010 0418020302200001EUR2 00410GXLT0165280223 280223COMMISSION SUR REMISE D AVOIRS 1851684 00000000000133M000002
0518020302200001EUR2 00410GXLT0165280223 280223 REMISE N 2715010 0418020100200001EUR2 00410GXLT0191280223 280223ACHAT REMISE D AVOIRS REMISE N 1851684 00000000088920}000001
0518020100200001EUR2 00410GXLT0191280223 280223 2715010 0418020404100001EUR2 00410GXLT0121280223 260223VIREMENT BANCAIRE EN VOTRE FAVE 1842999 00000002360952M000070
0518020404100001EUR2 00410GXLT0121280223 260223URN 5286537 VIREMENT N 52865
0418020210700001EUR2 00410GXLT0191280223 280223FACTURE N 63574441 DEVENANT FIN 1834511 00000000006000{000001
0518020210700001EUR2 00410GXLT0191280223 280223ANCABLE GARANTIE DEBITEUR LERO
0418020302600001EUR2 00410GXLT0161270223 250223PRECOMPTE DE COMM. DE FINANCEME 1810893 00000000002268P000001
0518020302600001EUR2 00410GXLT0161270223 250223NT VIREMENT N 5285067 0418020545100001EUR2 00410GXLT0105270223 280223RESTITUTION REGLEMENT VIR LEROY 1805894 00000000009919F000001
0518020545100001EUR2 00410GXLT0105270223 280223MERLIN 777 571.60ï¿½ 0418020101100001EUR2 00410GXLT0191270223 270223REPRISE DE FACTURES INDISPONIBL 1780522 00000002375267L000004
0518020101100001EUR2 00410GXLT0191270223 270223ES REMISE N 2712826 0418020303100001EUR2 00410GXLT0167270223 270223TVA SUR COMMISSION D AFFACTURAG 1780522 00000000000846J000003
0518020303100001EUR2 00410GXLT0167270223 270223E SUR REMISE N 2712826 0418020302100001EUR2 00410GXLT0165270223 270223COMMISSION D AFFACTURAGE SUR RE 1780522 00000000004230O000002
0518020302100001EUR2 00410GXLT0165270223 270223MISE N 2712826 0418020100100001EUR2 00410GXLT0191270223 270223ACHAT REMISE DE FACTURES REMIS 1780522 00000002820357B000001
0518020100100001EUR2 00410GXLT0191270223 270223E N 2712826 0718020 00001EUR2 00410GXLT01
030323 0000000773178H`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('various', () => {
    const text = `0130012    00585EUR2 00010156142  280323                                                  0000006564827I
0430012056800585EUR2 0001015614218290323  290323DOMUSVI                          0000000  0000000359190{
0530012056800585EUR2 0001015614218290323     NPYDOMUSVI
0530012056800585EUR2 0001015614218290323     LCC/INV/3867 8.2.2023
0530012056800585EUR2 0001015614218290323     RCNNOTPROVIDED
0530012056800585EUR2 0001015614218290323     PDOFR FRANCE
0430012081800585EUR2 00010156142B2290323  290323PRLV SEPA/DGFIP IMPOT                   0 0000000560630}FR46ZZZ005002
0530012081800585EUR2 00010156142B2290323     NBEDGFIP IMPOT
0530012081800585EUR2 00010156142B2290323     IBEFR46ZZZ005002
0530012081800585EUR2 00010156142B2290323     RUMNN804148211DGFIP2019921505K41FN7QQ
0530012081800585EUR2 00010156142B2290323     RCN220750510700113748308
0530012081800585EUR2 00010156142B2290323     LCCTVA-032023-3310CA3
0730012    00585EUR2 00010156142  290323                                                  0000006363387I`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('Known bank', () => {
    const text = `0118020    00001EUR2 00410GXLT01  060423                                                  0000000012258N
0418020404100001EUR2 00410GXLT0121070423  050423VIREMENT BANCAIRE EN VOTRE FAVE  3175387 00000000594363K000070
0518020404100001EUR2 00410GXLT0121070423  050423URN 5335098    VIREMENT N 53350
0418020312600001EUR2 00410GXLT0167070423  050423TVA SUR PRECOMPTE DE COMM. DE F  3175387 00000000001429P000002
0518020312600001EUR2 00410GXLT0167070423  050423INANCEMENT   VIREMENT N 5335098
0718020    00001EUR2 00410GXLT01  070423                                                  0000000000000} `;

    expect(parse(text)).toMatchSnapshot();
  });

  test('Known bank 2', () => {
    const text = `0118020    00001EUR2 00410GXLT01  030323                                                  0000000773178H
0418020404100001EUR2 00410GXLT0121060323  040323VIREMENT BANCAIRE EN VOTRE FAVE  2059801 00000000771083K000070
0518020404100001EUR2 00410GXLT0121060323  040323URN 5295341    VIREMENT N 52953
0418020312600001EUR2 00410GXLT0167060323  040323TVA SUR PRECOMPTE DE COMM. DE F  2059801 00000000000349L000002
0518020312600001EUR2 00410GXLT0167060323  040323INANCEMENT   VIREMENT N 5295341
0418020302600001EUR2 00410GXLT0161060323  040323PRECOMPTE DE COMM. DE FINANCEME  2059801 00000000001746L000001
0518020302600001EUR2 00410GXLT0161060323  040323NT   VIREMENT N 5295341
0718020    00001EUR2 00410GXLT01  060323                                                  0000000000000}
0118020    00001EUR2 00410GXLT11  030323                                                  0000025068056R
0418020464100001EUR2 00410GXLT1191060323  040323MONTANT AVIS DE CREDIT  PAYE PA  2059801 00000000389972L000077
0518020464100001EUR2 00410GXLT1191060323  040323R VIREMENT  5295341
0418020434100001EUR2 00410GXLT1191060323  150423MONTANT FINANCE  PAR VIREMENT 5  2059801 00000000381110R000028
0518020434100001EUR2 00410GXLT1191060323  150423295341
0418020312600001EUR2 00410GXLT1167060323  040323TVA SUR PRECOMPTE DE COMM. DE F  2059801 00000000000349L000013
0518020312600001EUR2 00410GXLT1167060323  040323INANCEMENT   VIREMENT N 5295341
0418020302600001EUR2 00410GXLT1161060323  040323PRECOMPTE DE COMM. DE FINANCEME  2059801 00000000001746L000009
0518020302600001EUR2 00410GXLT1161060323  040323NT   VIREMENT N 5295341
0718020    00001EUR2 00410GXLT11  060323                                                  0000025841235P                `;

    expect(parse(text)).toMatchSnapshot();
  });

  test('Known bank 3 - no transactions', () => {
    const text = `0118020    00001EUR2 00410GXLT01  210323                                                  0000000000000}
0718020    00001EUR2 00410GXLT01  220323                                                  0000000000000}
0118020    00001EUR2 00410GXLT11  210323                                                  0000019966371M
0718020    00001EUR2 00410GXLT11  220323                                                  0000019966371M                `;

    expect(parse(text)).toMatchSnapshot();
  });

  test('unknown bank - missed lines', () => {
    const text = `0118020    00001EUR2 00410FVXE01  300623                                                  0000000551132H
0418020312900001EUR2 00410FVXE0167030723  300623TVA SUR FRAIS D AVIS DE LITIG M  6018370 00000000000231}000002
0518020312900001EUR2 00410FVXE0167030723  300623OIS DE JUIN 2023
0418020302900001EUR2 00410FVXE0165030723  300623FRAIS D AVIS DE LITIG MOIS DE J  6018370 00000000001155}000001
0518020302900001EUR2 00410FVXE0165030723  300623UIN 2023
0418020312800001EUR2 00410FVXE0167030723  300623TVA SUR FRAIS DEMANDE D AGREMEN  6018369 00000000000320}000002
0518020312800001EUR2 00410FVXE0167030723  300623T PERIODE   JUIN 2023
0418020302800001EUR2 00410FVXE0165030723  300623FRAIS DEMANDE D AGREMENT PERIOD  6018369 00000000001600}000001
0518020302800001EUR2 00410FVXE0165030723  300623E   JUIN 2023
0418020505100001EUR2 00410FVXE0105030723  070723VIREMENT RECU  FACTURE N F2023-  6015954 00000000124860{000001
0518020505100001EUR2 00410FVXE0105030723  0707230335 ASCENS PARIS
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0504 GARANTIE DEV  6003520 00000000138600{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0467 GARANTIE DEV  6003518 00000000187440{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0461 GARANTIE DEV  6003517 00000000153000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0462 GARANTIE DEV  6003515 00000000051000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0489 GARANTIE DEV  6003513 00000000063000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0506 GARANTIE DEV  6003511 00000000259440{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0508 GARANTIE DEV  6003463 00000000516000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0513 GARANTIE DEV  6003458 00000000205920{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0476 GARANTIE DEV  6003456 00000000155760{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE EGIS
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0483 GARANTIE DEV  6003451 00000000105537H000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0469 GARANTIE DEV  6003444 00000000085800{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE B INF
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0486 GARANTIE DEV  6003443 00000000156000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALAIN
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0517 GARANTIE DEV  6003433 00000000000760F000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0485 GARANTIE DEV  6003417 00000000166800{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE QUADI
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0509 GARANTIE DEV  6003410 00000000141780{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE QUADI
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0474 GARANTIE DEV  6003403 00000000142560{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0495 GARANTIE DEV  6003398 00000000136740{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0525 GARANTIE DEV  6003389 00000000097200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0520 GARANTIE DEV  6003382 00000000153600{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE B INF
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0526 GARANTIE DEV  6003377 00000000132000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE B INF
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0521 GARANTIE DEV  6003360 00000000122400{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE AUTOD
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0472 GARANTIE DEV  6003354 00000000114000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALTUR
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0496 GARANTIE DEV  6003349 00000000137280{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALTUR
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0487 GARANTIE DEV  6003342 00000000206700{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALAIN
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0454 GARANTIE DEV  6003328 00000000115200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0460 GARANTIE DEV  6003327 00000000124800{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0498 GARANTIE DEV  6003322 00000000115200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0491 GARANTIE DEV  6003315 00000000153000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0522 GARANTIE DEV  6003309 00000000072000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0463 GARANTIE DEV  6003304 00000000151680{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0464 GARANTIE DEV  6003297 00000000142200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0507 GARANTIE DEV  6003264 00000000516000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020404100001EUR2 00410FVXE0121030723  010723VIREMENT BANCAIRE EN VOTRE FAVE  5994113 00000003000000}000070
0518020404100001EUR2 00410FVXE0121030723  010723URN 5441552    VIREMENT N 54415
0418020312600001EUR2 00410FVXE0167030723  010723TVA SUR PRECOMPTE DE COMM. DE F  5994113 00000000007358R000002
0518020312600001EUR2 00410FVXE0167030723  010723INANCEMENT   VIREMENT N 5441552
0418020302600001EUR2 00410FVXE0161030723  010723PRECOMPTE DE COMM. DE FINANCEME  5994113 00000000036794P000001
0518020302600001EUR2 00410FVXE0161030723  010723NT   VIREMENT N 5441552
0418020608100001EUR2 00410FVXE0191030723  030723PRELEVEMENT DE FG 20.00P SUR RE  5979041 00000001691756R000073
0518020608100001EUR2 00410FVXE0191030723  030723MISE N 2793426
0418020101100001EUR2 00410FVXE0191030723  030723REPRISE DE FACTURES INDISPONIBL  5979041 00000008032515Q000004
0518020101100001EUR2 00410FVXE0191030723  030723ES  REMISE N 2793426
0418020303100001EUR2 00410FVXE0167030723  030723TVA SUR COMMISSION D AFFACTURAG  5979041 00000000006628J000003
0518020303100001EUR2 00410FVXE0167030723  030723E SUR REMISE N 2793426
0418020302100001EUR2 00410FVXE0165030723  030723COMMISSION D AFFACTURAGE SUR RE  5979041 00000000033140N000002
0518020302100001EUR2 00410FVXE0165030723  030723MISE N 2793426
0418020100100001EUR2 00410FVXE0191030723  030723ACHAT REMISE DE FACTURES  REMIS  5979041 00000011835978{000001
0518020100100001EUR2 00410FVXE0191030723  030723E N 2793426
0418020353600001EUR2 00410FVXE0167010723  010723TVA SUR COMM. DE FINANCEMENT CO  5952864 00000000005282Q000002
0518020353600001EUR2 00410FVXE0167010723  010723MPLEMENTAIRE ARRETES DE LA PERI
0418020352600001EUR2 00410FVXE0161010723  010723COMM. DE FINANCEMENT COMPLEMENT  5952864 00000000026414K000001
0518020352600001EUR2 00410FVXE0161010723  010723AIRE ARRETES DE LA PERIODE 2023
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023-0406 DEVENANT F  5950621 00000000159840{000001
0518020210700001EUR2 00410FVXE0191010723  010723INANCABLE GARANTIE  DEBITEUR RE
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023-0407 DEVENANT F  5950620 00000000125400{000001
0518020210700001EUR2 00410FVXE0191010723  010723INANCABLE GARANTIE  DEBITEUR RE
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023--0408 DEVENANT   5950618 00000000164736{000001
0518020210700001EUR2 00410FVXE0191010723  010723FINANCABLE GARANTIE  DEBITEUR R
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023-0409 DEVENANT F  5950616 00000000050544{000001
0518020210700001EUR2 00410FVXE0191010723  010723INANCABLE GARANTIE  DEBITEUR RE
041802036BZ00001EUR2 00410FVXE01  010723  010723TVA SUR FRAIS DE GESTION DE CON  5950217 00000000000080}000002
051802036BZ00001EUR2 00410FVXE01  010723  010723TRAT EN LIGNE
041802032BZ00001EUR2 00410FVXE01  010723  010723FRAIS DE GESTION DE CONTRAT EN   5950217 00000000000400}000001
051802032BZ00001EUR2 00410FVXE01  010723  010723LIGNE
0718020    00001EUR2 00410FVXE01  030723                                                  0000005188211C
0118020    00001EUR2 00410FVXE11  300623                                                  0000022430685}
0418020312900001EUR2 00410FVXE1167030723  300623TVA SUR FRAIS D AVIS DE LITIG M  6018370 00000000000231}000006
0518020312900001EUR2 00410FVXE1167030723  300623OIS DE JUIN 2023
0418020302900001EUR2 00410FVXE1165030723  300623FRAIS D AVIS DE LITIG MOIS DE J  6018370 00000000001155}000005
0518020302900001EUR2 00410FVXE1165030723  300623UIN 2023
0418020312800001EUR2 00410FVXE1167030723  300623TVA SUR FRAIS DEMANDE D AGREMEN  6018369 00000000000320}000006
0518020312800001EUR2 00410FVXE1167030723  300623T PERIODE   JUIN 2023
0418020302800001EUR2 00410FVXE1165030723  300623FRAIS DEMANDE D AGREMENT PERIOD  6018369 00000000001600}000005
0518020302800001EUR2 00410FVXE1165030723  300623E   JUIN 2023
0418020505100001EUR2 00410FVXE1105030723  070723VIREMENT RECU  FACTURE N F2023-  6015954 00000000145920{000005
0518020505100001EUR2 00410FVXE1105030723  0707230335 ASCENS PARIS
0418020454100001EUR2 00410FVXE1191030723  010723MONTANT AVIS DE DEBIT  SOUSTRAI  5994113 00000001807856A000075
0518020454100001EUR2 00410FVXE1191030723  010723T DU FINANCEMENT VIREMENT  5441
0418020434100001EUR2 00410FVXE1191030723  210823MONTANT FINANCE  PAR VIREMENT 5  5994113 00000004807856J000028
0518020434100001EUR2 00410FVXE1191030723  210823441552
0418020312600001EUR2 00410FVXE1167030723  010723TVA SUR PRECOMPTE DE COMM. DE F  5994113 00000000007358R000013
0518020312600001EUR2 00410FVXE1167030723  010723INANCEMENT   VIREMENT N 5441552
0418020302600001EUR2 00410FVXE1161030723  010723PRECOMPTE DE COMM. DE FINANCEME  5994113 00000000036794P000009
0518020302600001EUR2 00410FVXE1161030723  010723NT   VIREMENT N 5441552
0418020505100001EUR2 00410FVXE1105030723  070723VIREMENT RECU  FACTURE N F2023-  5988580 00000000142800{000005
0518020505100001EUR2 00410FVXE1105030723  0707230334 ALAIN AFFLELOU FRANCHISEUR
0418020608100001EUR2 00410FVXE1191030723  030723PRELEVEMENT DE FG 20.00P SUR RE  5979041 00000001691756R000075
0518020608100001EUR2 00410FVXE1191030723  030723MISE N 2793426
0418020303100001EUR2 00410FVXE1167030723  030723TVA SUR COMMISSION D AFFACTURAG  5979041 00000000006628J000012
0518020303100001EUR2 00410FVXE1167030723  030723E SUR REMISE N 2793426
0418020302100001EUR2 00410FVXE1165030723  030723COMMISSION D AFFACTURAGE SUR RE  5979041 00000000033140N000011
0518020302100001EUR2 00410FVXE1165030723  030723MISE N 2793426
0418020353600001EUR2 00410FVXE1167010723  010723TVA SUR COMM. DE FINANCEMENT CO  5952864 00000000005282Q000006
0518020353600001EUR2 00410FVXE1167010723  010723MPLEMENTAIRE ARRETES DE LA PERI
0418020352600001EUR2 00410FVXE1161010723  010723COMM. DE FINANCEMENT COMPLEMENT  5952864 00000000026414K000005
0518020352600001EUR2 00410FVXE1161010723  010723AIRE ARRETES DE LA PERIODE 2023
041802036BZ00001EUR2 00410FVXE11  010723  010723TVA SUR FRAIS DE GESTION DE CON  5950217 00000000000080}000006
051802036BZ00001EUR2 00410FVXE11  010723  010723TRAT EN LIGNE
041802032BZ00001EUR2 00410FVXE11  010723  010723FRAIS DE GESTION DE CONTRAT EN   5950217 00000000000400}000005
051802032BZ00001EUR2 00410FVXE11  010723  010723LIGNE
0718020    00001EUR2 00410FVXE11  030723                                                  0000026953127J

`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('internal_code and operation code can be empty under conditions', () => {
    const text = `0130012    00585EUR2 00010156142  280323                                                  0000006564827I
0430012056800585EUR2 00010156142  290323  290323ABCDEFG                          0000000  0000000000000{
0430012    00585EUR2 0001015614218290323  290323ABCDEFG                          0000000  0000000000000{
0430012    00585EUR2 00010156142  290323  290323ABCDEFG                          0000000  0000000000000{
0730012    00585EUR2 00010156142  290323                                                  0000006564827I`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('various 2', () => {
    const text = `0130003    03328EUR2 00020409333  140723                                                  0000000001072G
0430003740003328EUR2 000204093336215072300130723ENT SEPA RECU                    00000001 0000000000000RFRAIS VIREM
0530003740003328EUR2 0002040933362150723     LIBREF 1380896458S
0530003740003328EUR2 0002040933362150723     LIBDE 23 23 EUR DU 13/07/23
0430003661003328EUR2 000204093332817072300170723CARTE X0154 15/07 TYPEFORM  S.L  00010000 0000000001068}.
0530003661003328EUR2 0002040933328170723     LIBCOMMERCE ELECTRONIQUE
0730003    03328EUR2 00020409333  170723                                                  0000000000003H`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('various 3', () => {
    const text = `0112206    04400EUR2 56022698740  160224        ** PAS DE MOUVEMENT CE JOUR **            0000000000000{  035
0712206    04400EUR2 56022698740  190224        ------------------------------            0000000000000{`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('no line breaks from jedeclare', () => {
    const text = `0117406    00283EUR2 65041564965  060324                                                  0000001071841C  047           0417406000200283EUR2E6504156496502070324  070324REMISE CHQ 6316889 RANDOM PILES  6316889100000000008252{                0717406    00283EUR2 65041564965  070324                                                  0000001307106B                `;

    expect(parse(text)).toMatchSnapshot();
  });

  test('no line breaks 2 from jedeclare', () => {
    const text = `0112736    00283EUR2 65039564932  050524                                                  0000001127600I  088           0412736005000283EUR2E65039564932B1060524  060524EDUSIGN                          0000000000000000002500}                0512736005000283EUR2E65039564932B1060524     NBEEDUSIGN                                                                 0512736005000283EUR2E65039564932B1060524     IBEFR89ZZZ86C6DB                      SEPA                                 0512736005000283EUR2E65039564932B1060524     NPYSINCITY                                                                 0512736005000283EUR2E65039564932B1060524     REF256150872                          CITISEPA036424302175211027438        0512736005000283EUR2E65039564932B1060524     LCCEDUSIGN                                                                 0512736005000283EUR2E65039564932B1060524     RUMFUHD1ONZFF77GD0B                   RCUR                                 0512736005000283EUR2E65039564932B1060524     CPYFR7612736002836503956493291                                             0412736000000283EUR2E6503956493205060524  060524VIR AFDAS 0392100                0392100100000000032128{                0512736000000283EUR2E6503956493205060524     NPYAFDAS                                                                   0512736000000283EUR2E6503956493205060524     NBESINCITY                                                                 0512736000000283EUR2E6503956493205060524     LCCF240521                                                                 0512736000000283EUR2E6503956493205060524     RCN0392100                                                                 0512736000000283EUR2E6503956493205060524     LIBSOGEFRPPXXX                                                             0512736000000283EUR2E6503956493205060524     MMOEUR200000000321280                                                      0412736005200283EUR2E6503956493211060524  060524CARTE X4030 ROOOTS KZMMNZM55LLN  0000000000000000000416L                0412736005200283EUR2E6503956493211060524  060524CARTE X4030 BLOODY LABS  INC. S  0000000000000000000573O                0412736005200283EUR2E6503956493211060524  060524CARTE X4030 ROOTS PUB COMINES    0000000000000000001250O                0412736005200283EUR2E6503956493211060524  060524CARTE X4030 BUREAU VALLEE AUBIN  0000000000000000003814R                0412736002600283EUR2E6503956493206060524  060524WEB JORDAN ADAM IBXBB SALAIRE K  0000000000000000016691R                0512736002600283EUR2E6503956493206060524     NPYASSOCIATION SINCITY                                                     0512736002600283EUR2E6503956493206060524     NBEJORDAN ADAM                                                             0512736002600283EUR2E6503956493206060524     LCCIBXBB SALAIRE SINCITY                                                   0512736002600283EUR2E6503956493206060524     RCNIBXBB SALAIRE SINCITY                                                   0512736002600283EUR2E6503956493206060524     LIBAGRIFRPP882                                                             0512736002600283EUR2E6503956493206060524     MMOEUR200000000166919                                                      0512736002600283EUR2E6503956493206060524     CBEFR6620041010123609093T03365                                             0412736002600283EUR2E6503956493206060524  060524WEB RAYMONDE SIMONETA IBXBB SAL  0000000000000000016842M                0512736002600283EUR2E6503956493206060524     NPYASSOCIATION SINCITY                                                     0512736002600283EUR2E6503956493206060524     NBERAYMONDE SIMONETA                                                       0512736002600283EUR2E6503956493206060524     LCCIBXBB SALAIRE SINCITY                                                   0512736002600283EUR2E6503956493206060524     RCNIBXBB SALAIRE SINCITY                                                   0512736002600283EUR2E6503956493206060524     LIBAGRIFRPP882                                                             0512736002600283EUR2E6503956493206060524     MMOEUR200000000168424                                                      0512736002600283EUR2E6503956493206060524     CBEFR7615589335540619874514069                                             0412736005200283EUR2E6503956493211060524  060524CARTE X0566 GRDF INTERNET PARIS  0000000000000000001870}                0412736005200283EUR2E6503956493211060524  060524CARTE X4030 GRDF INTERNET PARIS  0000000000000000001030}                0712736    00283EUR2 65039564932  060524                                                  0000001114739B  088           0112736    00283EUR2 65039564932  030524                                                  0000001127600I  088           0712736    00283EUR2 65039564932  040524                                                  0000001127600I  088           0112736    00283EUR2 65039564932  040524                                                  0000001127600I  088           0712736    00283EUR2 65039564932  050524                                                  0000001127600I  088`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('manually added line breaks 2 to jedeclare', () => {
    const text = `0112736    00283EUR2 65039564932  050524                                                  0000001127600I  088
0412736005000283EUR2E65039564932B1060524  060524EDUSIGN                          0000000000000000002500}
0512736005000283EUR2E65039564932B1060524     NBEEDUSIGN
0512736005000283EUR2E65039564932B1060524     IBEFR89ZZZ86C6DB                      SEPA
0512736005000283EUR2E65039564932B1060524     NPYSINCITY
0512736005000283EUR2E65039564932B1060524     REF256150872                          CITISEPA036424302175211027438
0512736005000283EUR2E65039564932B1060524     LCCEDUSIGN
0512736005000283EUR2E65039564932B1060524     RUMFUHD1ONZFF77GD0B                   RCUR
0512736005000283EUR2E65039564932B1060524     CPYFR7612736002836503956493291
0412736000000283EUR2E6503956493205060524  060524VIR AFDAS 0392100                0392100100000000032128{
0512736000000283EUR2E6503956493205060524     NPYAFDAS
0512736000000283EUR2E6503956493205060524     NBESINCITY
0512736000000283EUR2E6503956493205060524     LCCF240521
0512736000000283EUR2E6503956493205060524     RCN0392100
0512736000000283EUR2E6503956493205060524     LIBSOGEFRPPXXX
0512736000000283EUR2E6503956493205060524     MMOEUR200000000321280
0412736005200283EUR2E6503956493211060524  060524CARTE X4030 ROOOTS KZMMNZM55LLN  0000000000000000000416L
0412736005200283EUR2E6503956493211060524  060524CARTE X4030 BLOODY LABS  INC. S  0000000000000000000573O
0412736005200283EUR2E6503956493211060524  060524CARTE X4030 ROOTS PUB COMINES    0000000000000000001250O
0412736005200283EUR2E6503956493211060524  060524CARTE X4030 BUREAU VALLEE AUBIN  0000000000000000003814R
0412736002600283EUR2E6503956493206060524  060524WEB JORDAN ADAM IBXBB SALAIRE K  0000000000000000016691R
0512736002600283EUR2E6503956493206060524     NPYASSOCIATION SINCITY
0512736002600283EUR2E6503956493206060524     NBEJORDAN ADAM
0512736002600283EUR2E6503956493206060524     LCCIBXBB SALAIRE SINCITY
0512736002600283EUR2E6503956493206060524     RCNIBXBB SALAIRE SINCITY
0512736002600283EUR2E6503956493206060524     LIBAGRIFRPP882
0512736002600283EUR2E6503956493206060524     MMOEUR200000000166919
0512736002600283EUR2E6503956493206060524     CBEFR6620041010123609093T03365
0412736002600283EUR2E6503956493206060524  060524WEB RAYMONDE SIMONETA IBXBB SAL  0000000000000000016842M
0512736002600283EUR2E6503956493206060524     NPYASSOCIATION SINCITY
0512736002600283EUR2E6503956493206060524     NBERAYMONDE SIMONETA
0512736002600283EUR2E6503956493206060524     LCCIBXBB SALAIRE SINCITY
0512736002600283EUR2E6503956493206060524     RCNIBXBB SALAIRE SINCITY
0512736002600283EUR2E6503956493206060524     LIBAGRIFRPP882
0512736002600283EUR2E6503956493206060524     MMOEUR200000000168424
0512736002600283EUR2E6503956493206060524     CBEFR7615589335540619874514069
0412736005200283EUR2E6503956493211060524  060524CARTE X0566 GRDF INTERNET PARIS  0000000000000000001870}
0412736005200283EUR2E6503956493211060524  060524CARTE X4030 GRDF INTERNET PARIS  0000000000000000001030}
0712736    00283EUR2 65039564932  060524                                                  0000001114739B  088
0112736    00283EUR2 65039564932  030524                                                  0000001127600I  088
0712736    00283EUR2 65039564932  040524                                                  0000001127600I  088
0112736    00283EUR2 65039564932  040524                                                  0000001127600I  088
0712736    00283EUR2 65039564932  050524                                                  0000001127600I  088`;

    expect(parse(text)).toMatchSnapshot();
  });

  // yogi
  test('no line breaks 3 from jedeclare', () => {
    const text = `0118309    00283EUR2 65189565024  210524                                                  0000000666845F  097           0418309007800283EUR2E6518956502462210524  220524FRAIS CARTE  TRANGER HORS UE     0000000100000000000010}                0418309007800283EUR2E6518956502462210524  220524FRAIS CARTE  TRANGER HORS UE     0000000100000000000145M                0718309    00283EUR2 65189565024  220524                                                  0000000666690B                `;

    expect(parse(text)).toMatchSnapshot();
  });

  // yogi
  test('line breaks only on header, not on rest, plus empty lines', () => {
    const text = `0118309    00283EUR2 65189565024  260524        ** PAS DE MOUVEMENT CE JOUR **            0000001420890A  100           0718309    00283EUR2 65189565024  270524        ** PAS DE MOUVEMENT CE JOUR **            0000001420890A  100           0118309    00283EUR2 65189565024  240524        ** PAS DE MOUVEMENT CE JOUR **            0000001420890A  100           0718309    00283EUR2 65189565024  250524        ** PAS DE MOUVEMENT CE JOUR **            0000001420890A  100           0118309    00283EUR2 65189565024  250524        ** PAS DE MOUVEMENT CE JOUR **            0000001420890A  100           0718309    00283EUR2 65189565024  260524        ** PAS DE MOUVEMENT CE JOUR **            0000001420890A  100

0118309    00283EUR2 65189565024  210524                                                  0000000666845F  097           0418309007800283EUR2E6518956502462210524  220524FRAIS CARTE  TRANGER HORS UE     0000000100000000000010}                0418309007800283EUR2E6518956502462210524  220524FRAIS CARTE  TRANGER HORS UE     0000000100000000000145M                0718309    00283EUR2 65189565024  220524                                                  0000000666690B

0118309    00283EUR2 65189565024  160524                                                  0000000615684B  095           0418309000000283EUR2E6518956502405170524  170524VIR OPCO 2I OFDA2I FORMATION     0000000100000000046200{                0518309000000283EUR2E6518956502405170524     NPYOPCO 2I                                                                 0518309000000283EUR2E6518956502405170524     NBENOSTRUM                                                                 0518309000000283EUR2E6518956502405170524     LCCVIR487-IDFR-962776-NOSTRUM                                              0518309000000283EUR2E6518956502405170524     RCNOFDA2I FORMATION                                                        0518309000000283EUR2E6518956502405170524     LIBCEPAFRPP751                                                             0518309000000283EUR2E6518956502405170524     MMOEUR200000000462000                                                      0418309000000283EUR2E6518956502405170524  170524VIR DRFIP ILE DE FRANCE ET DE P  5115700100000000000600{                0518309000000283EUR2E6518956502405170524     NPYDRFIP ILE DE FRANCE ET DE PARIS                                         0518309000000283EUR2E6518956502405170524     NBEASSOC. ASSOCIATION LIAIS                                                0518309000000283EUR2E6518956502405170524     NPOAGENCE DE SERVICES ET DE PAIEMENT                                       0518309000000283EUR2E6518956502405170524     NBUNOSTRUM                                                                 0518309000000283EUR2E6518956502405170524     LCC139619816 SCIV NA-000-21-00243-P1000 ASC SCIV NOSTRUM                   0518309000000283EUR2E6518956502405170524     RCN1D0750000139619816 TEL   0555115700                                     0518309000000283EUR2E6518956502405170524     LIBBDFEFRPP                                                                0518309000000283EUR2E6518956502405170524     MMOEUR200000000006000                                                      0418309005200283EUR2E6518956502411170524  170524CARTE X0566 KYRIAD ROGERS        0000000000000000000957O                0418309005200283EUR2E6518956502411170524  170524CARTE X0566 IT TRATTORIA ROGERS  0000000000000000000158}                0418309002600283EUR2E6518956502406170524  170524WEB HOTEL LILLE NEW KYLE QPFLL   0000000000000000003104}                0518309002600283EUR2E6518956502406170524     NPYASSOCIATION NOSTRUM                                                     0518309002600283EUR2E6518956502406170524     NBEHOTEL LILLE NEW KYLE                                                    0518309002600283EUR2E6518956502406170524     LCCCHAMBRES 206 208 20-21/06/24       HELENE CABY MARION MOUQUET           0518309002600283EUR2E6518956502406170524     RCNQPFLL NOSTRUM 20-21/06/24                                               0518309002600283EUR2E6518956502406170524     LIBAGRIFRPP882                                                             0518309002600283EUR2E6518956502406170524     MMOEUR200000000031040                                                      0518309002600283EUR2E6518956502406170524     CBEFR7630003037700002013303335                                             0718309    00283EUR2 65189565024  170524                                                  0000000658264F
0118309    00283EUR2 65189565024  210524                                                  0000000666845F  097           0418309007800283EUR2E6518956502462210524  220524FRAIS CARTE  TRANGER HORS UE     0000000100000000000010}                0418309007800283EUR2E6518956502462210524  220524FRAIS CARTE  TRANGER HORS UE     0000000100000000000145M                0718309    00283EUR2 65189565024  220524                                                  0000000666690B

0118309    00283EUR2 65189565024  200524                                                  0000000657935{  096           0418309000000283EUR2E6518956502405210524  210524VIR TYB JOBS VIREMENT SEPA PAR   0000000100000000018200{                0518309000000283EUR2E6518956502405210524     NPYTYB JOBS                                                                0518309000000283EUR2E6518956502405210524     NBENOSTRUM                                                                 0518309000000283EUR2E6518956502405210524     LCCNOSTRUM FACTURE F240539                                                 0518309000000283EUR2E6518956502405210524     RCNVIREMENT SEPA PAR INTERNET                                              0518309000000283EUR2E6518956502405210524     LIBCEPAFRPP751                                                             0518309000000283EUR2E6518956502405210524     MMOEUR200000000182000                                                      0418309005200283EUR2E6518956502411210524  210524CARTE X0566 FORNELLI ROGERS      0000000000000000000155}                0418309005200283EUR2E6518956502411210524  210524CARTE X0566 ROGHAN VTC DTTT BOR  0000000000000000000145}                0418309005200283EUR2E6518956502411210524  210524CARTE X4030 RACKETGOALS LLC 415  0000000000000000000488M                0418309005200283EUR2E6518956502411210524  210524CARTE X4030 AIRIMAGE.COM/BILL S  0000000000000000007267O                0418309005200283EUR2E6518956502411210524  210524CARTE X4030 RAPID PUB COMINES    0000000000000000001233M                0718309    00283EUR2 65189565024  210524                                                  0000000666845F  096           0118309    00283EUR2 65189565024  170524                                                  0000000658264F  096           0718309    00283EUR2 65189565024  180524                                                  0000000658264F  096           0118309    00283EUR2 65189565024  180524                                                  0000000658264F  096           0718309    00283EUR2 65189565024  190524                                                  0000000658264F  096           0118309    00283EUR2 65189565024  190524                                                  0000000658264F  096           0418309005000283EUR2E65189565024B1200524  200524FREE MOBILE                      0000000000000000000329O                0518309005000283EUR2E65189565024B1200524     NBEFREE MOBILE                                                             0518309005000283EUR2E65189565024B1200524     IBEFR07ZZZ591778                      SEPA                                 0518309005000283EUR2E65189565024B1200524     NPYNOSTRUM                                                                 0518309005000283EUR2E65189565024B1200524     IPYFMC-41823696                                                            0518309005000283EUR2E65189565024B1200524     REF257585102                                                               0518309005000283EUR2E65189565024B1200524     RUMFM-41114570-1                      RCUR                                 0518309005000283EUR2E65189565024B1200524     CPYFR7618309002836518956502491                                             0718309    00283EUR2 65189565024  200524                                                  0000000657935{  096
0118309    00283EUR2 65189565024  220524                                                  0000000666690B  098           0418309005000283EUR2E65189565024B2230524  230524B2B DGFIP                        0000000000000000042330}                0518309005000283EUR2E65189565024B2230524     NBEDGFIP                                                                   0518309005000283EUR2E65189565024B2230524     IBEFR46ZZZ005002                      SEPA                                 0518309005000283EUR2E65189565024B2230524     NBUDGFIP IMPOT                                                             0518309005000283EUR2E65189565024B2230524     NPYASSOC NOSTRUM                                                           0518309005000283EUR2E65189565024B2230524     IPY824244826-01-11                                                         0518309005000283EUR2E65189565024B2230524     REF257779319                          24142-5337-PSR-B2I-01-00709265       0518309005000283EUR2E65189565024B2230524     LCCPASDSN15052024-042024-82424482600064                                    0518309005000283EUR2E65189565024B2230524     RUMNN824244826DGFIP2020159699K6J36J76 RCUR                                 0518309005000283EUR2E65189565024B2230524     CPYFR7618309002836518956502491                                             0418309005000283EUR2E65189565024B1230524  230524FREE MOBILE                      0000000000000000000912M                0518309005000283EUR2E65189565024B1230524     NBEFREE MOBILE                                                             0518309005000283EUR2E65189565024B1230524     IBEFR07ZZZ591778                      SEPA                                 0518309005000283EUR2E65189565024B1230524     NPYASSOCIATION NOSTRUM                                                     0518309005000283EUR2E65189565024B1230524     IPYFMC-33495513                                                            0518309005000283EUR2E65189565024B1230524     REF257835205                                                               0518309005000283EUR2E65189565024B1230524     RUMFM-37872046-1                      RCUR                                 0518309005000283EUR2E65189565024B1230524     CPYFR7618309002836518956502491                                             0418309005000283EUR2E65189565024B1230524  230524SAS GAROFIBRE FRANCE             0000000000000000000660}                0518309005000283EUR2E65189565024B1230524     NBESAS GAROFIBRE FRANCE                                                    0518309005000283EUR2E65189565024B1230524     IBEFR71ZZZ587716                      SEPA                                 0518309005000283EUR2E65189565024B1230524     NPYNOSTRUM                                                                 0518309005000283EUR2E65189565024B1230524     REF257835490                          T241430000266298                     0518309005000283EUR2E65189565024B1230524     LCCEAF-2024050646                                                          0518309005000283EUR2E65189565024B1230524     RUMRUM0001867-EAF                     RCUR                                 0518309005000283EUR2E65189565024B1230524     CPYFR7618309002836518956502491                                             0418309000000283EUR2E6518956502405230524  230524VIR TRESORERIE LILLE DELEGATION  2113734100000000010000{                0518309000000283EUR2E6518956502405230524     NPYTRESORERIE LILLE DELEGATION                                             0518309000000283EUR2E6518956502405230524     NBENOSTRUM                                                                 0518309000000283EUR2E6518956502405230524     NPOVILLE DE LILLE - BUDGET PRINCIPA                                        0518309000000283EUR2E6518956502405230524     LCC24/146PDV NOSTRUMVILLE DE LILLE - BUDGET PRINCIPA                       0518309000000283EUR2E6518956502405230524     RCN160590240532002024-05-2113734                                           0518309000000283EUR2E6518956502405230524     LIBBDFEFRPP                                                                0518309000000283EUR2E6518956502405230524     MMOEUR200000000100000                                                      0418309002600283EUR2E6518956502406230524  230524WEB IMPOTS ENTREPRISES P CREANC  0000000000000000104560}                0518309002600283EUR2E6518956502406230524     NPYASSOCIATION NOSTRUM                                                     0518309002600283EUR2E6518956502406230524     NBEIMPOTS ENTREPRISES PARIS 20                                             0518309002600283EUR2E6518956502406230524     LCCCREANCE 202445450 NOSTRUM          TAXE SUR LES SALAIRES MARS 2024      0518309002600283EUR2E6518956502406230524     RCNCREANCE 202445450 NOSTRUM                                               0518309002600283EUR2E6518956502406230524     LIBAGRIFRPP882                                                             0518309002600283EUR2E6518956502406230524     MMOEUR200000001045600                                                      0518309002600283EUR2E6518956502406230524     CBEFR7630001000644691009525996                                             0418309005200283EUR2E6518956502411230524  230524CARTE X4030 LIFA PARIS           0000000000000000000100}                0718309    00283EUR2 65189565024  230524                                                  0000000528127H
0118309    00283EUR2 65189565024  230524                                                  0000000528127H  099           0418309005000283EUR2E65189565024B1240524  240524SEM ASIAMUSICOLOGIES             0000000000000000013417M                0518309005000283EUR2E65189565024B1240524     NBESEM ASIAMUSICOLOGIES                                                    0518309005000283EUR2E65189565024B1240524     IBEFR23ZZZ607786                      SEPA                                 0518309005000283EUR2E65189565024B1240524     NPYNOSTRUM                                                                 0518309005000283EUR2E65189565024B1240524     REF257937043                          NOSTRUM                              0518309005000283EUR2E65189565024B1240524     LCCREGLT. PRELEV NOSTRUM                                                   0518309005000283EUR2E65189565024B1240524     RUMEURA0414                           RCUR                                 0518309005000283EUR2E65189565024B1240524     CPYFR7618309002836518956502491                                             0418309005000283EUR2E65189565024B1240524  240524B2V GESTION GU COTISATIO         0000000000000000098861P                0518309005000283EUR2E65189565024B1240524     NBEB2V GESTION GU COTISATIO                                                0518309005000283EUR2E65189565024B1240524     IBEFR92ZZZ498486                      SEPA                                 0518309005000283EUR2E65189565024B1240524     NPYNOSTRUM                                                                 0518309005000283EUR2E65189565024B1240524     REF257979938                          T241440002351726                     0518309005000283EUR2E65189565024B1240524     LCCB2V  63388707.1701105 DU 240524                                         0518309005000283EUR2E65189565024B1240524     RUMRUBE000067226X                     RCUR                                 0518309005000283EUR2E65189565024B1240524     CPYFR7618309002836518956502491                                             0418309005000283EUR2E65189565024B1240524  240524FREE MOBILE                      0000000000000000000057}                0518309005000283EUR2E65189565024B1240524     NBEFREE MOBILE                                                             0518309005000283EUR2E65189565024B1240524     IBEFR07ZZZ591778                      SEPA                                 0518309005000283EUR2E65189565024B1240524     NPYJOHN FIT                                                                0518309005000283EUR2E65189565024B1240524     IPYFMC-48905510                                                            0518309005000283EUR2E65189565024B1240524     REF257994665                                                               0518309005000283EUR2E65189565024B1240524     RUMFM-50409381-1                      RCUR                                 0518309005000283EUR2E65189565024B1240524     CPYFR7618309002836518956502491                                             0418309000000283EUR2E6518956502405240524  240524VIR DRFIP ILE DE FRANCE ET DE P  0633400100000000003000{                0518309000000283EUR2E6518956502405240524     NPYDRFIP ILE DE FRANCE ET DE PARIS                                         0518309000000283EUR2E6518956502405240524     NBEASSOC. ASSOCIATION LIAIS                                                0518309000000283EUR2E6518956502405240524     NPOAGENCE DE SERVICES ET DE PAIEMENT                                       0518309000000283EUR2E6518956502405240524     NBUNOSTRUM                                                                 0518309000000283EUR2E6518956502405240524     LCC139734237 SCIV NA-000-21-00243-S1001 ASC SCIV NOSTRUM                   0518309000000283EUR2E6518956502405240524     RCN1D0750000139734237 TEL   0320633400                                     0518309000000283EUR2E6518956502405240524     LIBBDFEFRPP                                                                0518309000000283EUR2E6518956502405240524     MMOEUR200000000030000                                                      0418309000000283EUR2E6518956502405240524  240524VIR DRFIP ILE DE FRANCE ET DE P  5115700100000000004133C                0518309000000283EUR2E6518956502405240524     NPYDRFIP ILE DE FRANCE ET DE PARIS                                         0518309000000283EUR2E6518956502405240524     NBEASSOC. ASSOCIATION LIAIS                                                0518309000000283EUR2E6518956502405240524     NPOAGENCE DE SERVICES ET DE PAIEMENT                                       0518309000000283EUR2E6518956502405240524     NBUNOSTRUM                                                                 0518309000000283EUR2E6518956502405240524     LCC139734236 SCIV NA-000-21-00243-P1000 ASC SCIV NOSTRUM                   0518309000000283EUR2E6518956502405240524     RCN1D0750000139734236 TEL   0555115700                                     0518309000000283EUR2E6518956502405240524     LIBBDFEFRPP                                                                0518309000000283EUR2E6518956502405240524     MMOEUR200000000041333                                                      0418309005200283EUR2E6518956502411240524  240524CARTE X4030 HELLER HODKIEWIC DU  0000000000000000000547M                0418309005200283EUR2E6518956502411240524  240524CARTE X4030 YAMM.COM 1190 BRUSS  0000000000000000000600}                0418309002600283EUR2E6518956502406240524  240524WEB GOLEM RHIZOTTO GHYSE IBXAA   0000000000000000000887N                0518309002600283EUR2E6518956502406240524     NPYASSOCIATION NOSTRUM                                                     0518309002600283EUR2E6518956502406240524     NBEGOLEM RHIZOTTO GHYSE                                                    0518309002600283EUR2E6518956502406240524     LCCIBXAA SERVICE CIVIQUE NOSTRUM                                           0518309002600283EUR2E6518956502406240524     RCNIBXAA SERVICE CIVIQUE NOSTRUM                                           0518309002600283EUR2E6518956502406240524     LIBAGRIFRPP882                                                             0518309002600283EUR2E6518956502406240524     MMOEUR200000000008875                                                      0518309002600283EUR2E6518956502406240524     CBEFR7640618804050004041134186                                             0418309000000283EUR2E6518956502405240524  240524VIREMENT INTERNE ASSOCIATION KO  0000000100000001000000{                0518309000000283EUR2E6518956502405240524     NPYASSOCIATION NOSTRUM                                                     0518309000000283EUR2E6518956502405240524     NBEASSOCIATION NOSTRUM                                                     0518309000000283EUR2E6518956502405240524     LCCVIREMENT INTERNE                                                        0518309000000283EUR2E6518956502405240524     RCNVIREMENT INTERNE                                                        0518309000000283EUR2E6518956502405240524     LIBAGRIFRPP882                                                             0518309000000283EUR2E6518956502405240524     MMOEUR200000010000000                                                      0518309000000283EUR2E6518956502405240524     CBEFR7618309002836518956502491                                             0718309    00283EUR2 65189565024  240524                                                  0000001420890A                `;

    expect(parse(text)).toMatchSnapshot();
  });

  test('same transaction multiple times', () => {
    const text = `0130012    03120EUR2 06711268449  280524                                                  0000014841723C
0430012056803120EUR2 0671126844918290524  290524LES CROQUETTE                    0000000  0000000007200{375880114
0430012056803120EUR2 0671126844918290524  290524PARFUMERI KIPU S A               0000000  0000000020000{3C0220000014523C
0430012051203120EUR2 0671126844921290524  290524VR.PERMANENT GESTION DUE         00000000 0000000136956}
0430012051203120EUR2 0671126844921290524  290524VR.PERMANENT GESTION DUE         00000000 0000000136956}
0430012051203120EUR2 0671126844921290524  290524VR.PERMANENT GESTION DUE         00000000 0000000136956}
0730012    03120EUR2 06711268449  290524                                                  0000014458055C`;

    expect(parse(text)).toMatchSnapshot();
  });

  test('no line breaks from jedeclare 3', () => {
    const text = `0117806    00245EUR2 63138567924  010924                                                  0000000611809A  169           0418206000000283EUR2E6503956492505020924  020924VIR AGDIS 0375061                0425072100000000037561H                0518206000000283EUR2E6503956492505020924     NPYAFDAS                                                                   0518206000000283EUR2E6503956492505020924     NBESUCMIN                                                                 0518206000000283EUR2E6503956492505020924     LCCF231578 F234567                                                         0518206000000283EUR2E6503956492505020924     RCN0425072                                                                 0518206000000283EUR2E6503956492505020924     LIBSOGEFRPPXXX                                                             0518206000000283EUR2E6503956492505020924     MMOEUR200000000375618                                                      0418206000000283EUR2E65039564925C2020924  020924VIR INST DE OPTIMA-SYNTER INTER  0000000100000000000959D                0518206000000283EUR2E65039564925C2020924     NPYOPTIMA-SYNTER INTERNATIONAL VZW                                         0518206000000283EUR2E65039564925C2020924     NBESUCMIN                                                                 0518206000000283EUR2E65039564925C2020924     LCCREF FACTURE F231575                                                     0518206000000283EUR2E65039564925C2020924     REFIP801124088597                     3B65816AD63B4E2085C6750C7395A6D8     0518206000000283EUR2E65039564925C2020924     CBEFR7618206002836503956492591                                             0418206002600283EUR2E6503956492506020924  020924WEB TONY ROUTALLAUX TBXBA GRATI  0000000000000000005785N                0518206002600283EUR2E6503956492506020924     NPYASSOCIATION SUCMIN                                                     0518206002600283EUR2E6503956492506020924     NBETONY ROUTALLAUX                                                         0518206002600283EUR2E6503956492506020924     LCCTBXBA GRATIFICATION STAGE SUCMIN                                       0518206002600283EUR2E6503956492506020924     RCNTBXBA GRATIFICATION STAGE SUCMIN                                       0518206002600283EUR2E6503956492506020924     LIBAGRIFRPP882                                                             0518206002600283EUR2E6503956492506020924     MMOEUR200000000057855                                                      0518206002600283EUR2E6503956492506020924     CBEFR7616908000010200639767304                                             0718206    00245EUR2 63138567924  020924                                                  0000000644544H  169           0117806    00245EUR2 63138567924  300824                                                  0000000611809A  169           0718206    00245EUR2 63138567924  310824                                                  0000000611809A  169           0117806    00245EUR2 63138567924  310824                                                  0000000611809A  169           0718206    00245EUR2 63138567924  010924                                                  0000000611809A  169           `;

    expect(parse(text)).toMatchSnapshot();
  });
});

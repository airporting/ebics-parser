const parse = require('./index');

describe('ebics parser', function () {
  test('no transactions A', () => {
    const text = `0130004    00071EUR2 00010139479  280323                                                  0000003445691I
0730004    00071EUR2 00010139479  290323                                                  0000003445691I`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 0,
          end: 344569.19,
          start: 344569.19,
          transactions: 0,
        },
        header: {
          record_code: '01',
          bank_code: '30004',
          desk_code: '00071',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00010139479',
          prev_date: '2023-03-28',
          prev_amount: '344569.19',
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '30004',
          desk_code: '00071',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00010139479',
          next_date: '2023-03-29',
          next_amount: '344569.19',
        },
        transactions: [],
        problems: null,
      },
    ]);
  });

  test('no transactions B', () => {
    const text = `0130004    00823EUR2 00010738652  280323                                                  0000000008653O
0730004    00823EUR2 00010738652  290323                                                  0000000008653O`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 0,
          end: -865.36,
          start: -865.36,
          transactions: 0,
        },
        header: {
          record_code: '01',
          bank_code: '30004',
          desk_code: '00823',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00010738652',
          prev_date: '2023-03-28',
          prev_amount: '-865.36',
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '30004',
          desk_code: '00823',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00010738652',
          next_date: '2023-03-29',
          next_amount: '-865.36',
        },
        transactions: [],
        problems: null,
      },
    ]);
  });

  test('malformed - no footer  unknown line qualifier 03', () => {
    const text = `0118020 00001EUR2 00410GXLT01
030323 0000000000000} 0418020648900001EUR2 00410GXLT0191030323 030323RESTITUTION FONDS DE GARANTIE 2015123 00000000392067I000001
0518020648900001EUR2 00410GXLT0191030323 030323
0418020210400001EUR2 00410GXLT0191030323 030323FACTURE 86013179 NON GARANTIE 2014995 00000000006000{000001
0518020210400001EUR2 00410GXLT0191030323 030323DEVENANT FINANCABLE NON GARANTI
0418020404100001EUR2 00410GXLT0121030323 010323VIREMENT BANCAIRE EN VOTRE FAVE 1994254 00000001463361O000070
0518020404100001EUR2 00410GXLT0121030323 010323URN 5292443 VIREMENT N 52924
0418020302600001EUR2 00410GXLT0161030323 010323PRECOMPTE DE COMM. DE FINANCEME 1994254 00000000011488J000001
0518020302600001EUR2 00410GXLT0161030323 010323NT VIREMENT N 5292443 0418020101100001EUR2 00410GXLT0191030323 030323REPRISE DE FACTURES INDISPONIBL 1993288 00000000381110R000004
0518020101100001EUR2 00410GXLT0191030323 030323ES REMISE N 2717960 0418020303100001EUR2 00410GXLT0167030323 030323TVA SUR COMMISSION D AFFACTURAG 1993288 00000000000590}000003
0518020303100001EUR2 00410GXLT0167030323 030323E SUR REMISE N 2717960 0418020302100001EUR2 00410GXLT0165030323 030323COMMISSION D AFFACTURAGE SUR RE 1993288 00000000002950K000002
0518020302100001EUR2 00410GXLT0165030323 030323MISE N 2717960 0418020100100001EUR2 00410GXLT0191030323 030323ACHAT REMISE DE FACTURES REMIS 1993288 00000001966800{000001
0518020100100001EUR2 00410GXLT0191030323 030323E N 2717960 0418020353600001EUR2 00410GXLT0167020323 010323TVA SUR COMM. DE FINANCEMENT CO 1974131 00000000002523O000002
0518020353600001EUR2 00410GXLT0167020323 010323MPLEMENTAIRE ARRETES DE LA PERI
0418020352600001EUR2 00410GXLT0161020323 010323COMM. DE FINANCEMENT COMPLEMENT 1974131 00000000012617R000001
0518020352600001EUR2 00410GXLT0161020323 010323AIRE ARRETES DE LA PERIODE 2023
041802036BZ00001EUR2 00410GXLT01 010323 010323TVA SUR FRAIS DE GESTION DE CON 1891950 00000000000130}000002
051802036BZ00001EUR2 00410GXLT01 010323 010323TRAT EN LIGNE 041802032BZ00001EUR2 00410GXLT01 010323 010323FRAIS DE GESTION DE CONTRAT EN 1891950 00000000000650}000001
051802032BZ00001EUR2 00410GXLT01 010323 010323LIGNE 0418020312200001EUR2 00410GXLT0167280223 280223TVA SUR COMMISSION SUR REMISE D 1851684 00000000000026P000003
0518020312200001EUR2 00410GXLT0167280223 280223 AVOIRS REMISE N 2715010 0418020302200001EUR2 00410GXLT0165280223 280223COMMISSION SUR REMISE D AVOIRS 1851684 00000000000133M000002
0518020302200001EUR2 00410GXLT0165280223 280223 REMISE N 2715010 0418020100200001EUR2 00410GXLT0191280223 280223ACHAT REMISE D AVOIRS REMISE N 1851684 00000000088920}000001
0518020100200001EUR2 00410GXLT0191280223 280223 2715010 0418020404100001EUR2 00410GXLT0121280223 260223VIREMENT BANCAIRE EN VOTRE FAVE 1842999 00000002360952M000070
0518020404100001EUR2 00410GXLT0121280223 260223URN 5286537 VIREMENT N 52865
0418020210700001EUR2 00410GXLT0191280223 280223FACTURE N 63574441 DEVENANT FIN 1834511 00000000006000{000001
0518020210700001EUR2 00410GXLT0191280223 280223ANCABLE GARANTIE DEBITEUR LERO
0418020302600001EUR2 00410GXLT0161270223 250223PRECOMPTE DE COMM. DE FINANCEME 1810893 00000000002268P000001
0518020302600001EUR2 00410GXLT0161270223 250223NT VIREMENT N 5285067 0418020545100001EUR2 00410GXLT0105270223 280223RESTITUTION REGLEMENT VIR LEROY 1805894 00000000009919F000001
0518020545100001EUR2 00410GXLT0105270223 280223MERLIN 777 571.60ï¿½ 0418020101100001EUR2 00410GXLT0191270223 270223REPRISE DE FACTURES INDISPONIBL 1780522 00000002375267L000004
0518020101100001EUR2 00410GXLT0191270223 270223ES REMISE N 2712826 0418020303100001EUR2 00410GXLT0167270223 270223TVA SUR COMMISSION D AFFACTURAG 1780522 00000000000846J000003
0518020303100001EUR2 00410GXLT0167270223 270223E SUR REMISE N 2712826 0418020302100001EUR2 00410GXLT0165270223 270223COMMISSION D AFFACTURAGE SUR RE 1780522 00000000004230O000002
0518020302100001EUR2 00410GXLT0165270223 270223MISE N 2712826 0418020100100001EUR2 00410GXLT0191270223 270223ACHAT REMISE DE FACTURES REMIS 1780522 00000002820357B000001
0518020100100001EUR2 00410GXLT0191270223 270223E N 2712826 0718020 00001EUR2 00410GXLT01
030323 0000000773178H`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: undefined,
          end: undefined,
          start: undefined,
          transactions: 148386.63,
        },
        header: {
          record_code: '01',
          bank_code: '18020',
          _1: '000',
        },
        footer: {},
        transactions: [
          {
            record_code: '04',
            bank_code: '18020',
            internal_code: '6489',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410GXLT01',
            operation_code: '91',
            operation_date: '2023-03-03',
            reject_code: '',
            _2: '0303',
            _3: '0',
            exempt_code: '0',
            label: 'RESTITUTION FONDS DE GARANTIE 2',
            reference: '5123 00',
            value_date: '2023-03-03',
            undefined: undefined,
          },
          {
            record_code: '04',
            bank_code: '18020',
            internal_code: '2104',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410GXLT01',
            operation_code: '91',
            operation_date: '2023-03-03',
            reject_code: '',
            '23D': 'EVENANT FINANCABLE NON GARANTI',
            _2: '0303',
            _3: '0',
            exempt_code: '0',
            label: 'FACTURE 86013179 NON GARANTIE 2',
            reference: '4995 00',
            value_date: '2023-03-03',
          },
          {
            record_code: '04',
            bank_code: '18020',
            internal_code: '4041',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410GXLT01',
            operation_code: '21',
            operation_date: '2023-03-03',
            reject_code: '',
            '23U': 'RN 5292443 VIREMENT N 52924',
            _2: '0103',
            _3: '0',
            '_4:': '000070',
            amount: '-146336.16',
            exempt_code: '',
            label: 'VIREMENT BANCAIRE EN VOTRE FAVE',
            reference: '1994254',
            value_date: '2023-03-01',
          },
          {
            record_code: '04',
            bank_code: '18020',
            internal_code: '3536',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410GXLT01',
            operation_code: '67',
            operation_date: '2023-03-02',
            reject_code: '',
            '23N':
              'T VIREMENT N 5292443 0418020101100001EUR2 00410GXLT0191030323 030323REPRISE DE FACTURES INDISPONIBL 1993288 00000000381110R000004',
            _2: '0103',
            '23E':
              'N 2717960 0418020353600001EUR2 00410GXLT0167020323 010323TVA SUR COMM. DE FINANCEMENT CO 1974131 00000000002523O000002',
            '23M': 'PLEMENTAIRE ARRETES DE LA PERI',
            _3: '0',
            '_4:': '000001',
            amount: '-1148.81',
            exempt_code: '',
            label: 'PRECOMPTE DE COMM. DE FINANCEME',
            reference: '1994254',
            value_date: '2023-03-01',
          },
          {
            record_code: '04',
            bank_code: '18020',
            internal_code: '3526',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410GXLT01',
            operation_code: '61',
            operation_date: '2023-03-02',
            reject_code: '',
            '23A': 'IRE ARRETES DE LA PERIODE 2023',
            _2: '0103',
            _3: '0',
            '_4:': '000001',
            amount: '-1261.79',
            exempt_code: '',
            label: 'COMM. DE FINANCEMENT COMPLEMENT',
            reference: '1974131',
            value_date: '2023-03-01',
          },
          {
            record_code: '04',
            bank_code: '18020',
            internal_code: '4041',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            _3: '0',
            account_nb: '00410GXLT01',
            operation_code: '21',
            operation_date: '2023-02-28',
            _2: '2602',
            23: '2715010 0418020404100001EUR2 00410GXLT0121280223 260223VIREMENT BANCAIRE EN VOTRE FAVE 1842999 00000002360952M000070',
            '23U': 'RN 5286537 VIREMENT N 52865',
            undefined: undefined,
            '_4:': '000002',
            amount: '-13',
            exempt_code: '',
            label: 'TVA SUR FRAIS DE GESTION DE CON',
            reference: '1891950',
            reject_code: '',
            value_date: '2023-03-01',
          },
          {
            record_code: '04',
            bank_code: '18020',
            internal_code: '2107',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            _3: '0',
            '_4:': '000001',
            account_nb: '00410GXLT01',
            operation_code: '91',
            operation_date: '2023-02-28',
            reference: '1834511',
            reject_code: '',
            value_date: '2023-02-28',
            '23A': 'NCABLE GARANTIE DEBITEUR LERO',
            _2: '2802',
            amount: '600',
            exempt_code: '',
            label: 'FACTURE N 63574441 DEVENANT FIN',
          },
          {
            '23E': 'N 2712826 0718020 00001EUR2 00410GXLT01',
            '23M':
              'ISE N 2712826 0418020100100001EUR2 00410GXLT0191270223 270223ACHAT REMISE DE FACTURES REMIS 1780522 00000002820357B000001',
            '23N':
              'T VIREMENT N 5285067 0418020545100001EUR2 00410GXLT0105270223 280223RESTITUTION REGLEMENT VIR LEROY 1805894 00000000009919F000001',
            _1: '',
            _2: '2702',
            _3: '0',
            '_4:': '000001',
            account_nb: '00410GXLT01',
            amount: '-226.87',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '1001',
            label: 'PRECOMPTE DE COMM. DE FINANCEME',
            nb_of_dec: '2',
            operation_code: '91',
            operation_date: '2023-02-27',
            record_code: '04',
            reference: '1810893',
            reject_code: '',
            value_date: '2023-02-25',
          },
        ],
        problems: [
          {
            message: 'No start amount',
          },
          {
            message: 'No end amount',
          },
          {
            details: '"header.desk_code" is required',
            message: 'Malformed account',
          },
        ],
      },
    ]);
  });

  test('various', () => {
    const text = `0130004    00585EUR2 00010156142  280323                                                  0000006564827I
0430004056800585EUR2 0001015614218290323  290323DOMUSVI                          0000000  0000000359190{
0530004056800585EUR2 0001015614218290323     NPYDOMUSVI
0530004056800585EUR2 0001015614218290323     LCC/INV/3867 8.2.2023
0530004056800585EUR2 0001015614218290323     RCNNOTPROVIDED
0530004056800585EUR2 0001015614218290323     PDOFR FRANCE
0430004081800585EUR2 00010156142B2290323  290323PRLV SEPA/DGFIP IMPOT                   0 0000000560630}FR46ZZZ005002
0530004081800585EUR2 00010156142B2290323     NBEDGFIP IMPOT
0530004081800585EUR2 00010156142B2290323     IBEFR46ZZZ005002
0530004081800585EUR2 00010156142B2290323     RUMNN804148211DGFIP2019921505K41FN7QQ
0530004081800585EUR2 00010156142B2290323     RCN220750510700113748308
0530004081800585EUR2 00010156142B2290323     LCCTVA-032023-3310CA3
0730004    00585EUR2 00010156142  290323                                                  0000006363387I`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 20144,
          end: 636338.79,
          start: 656482.79,
          transactions: 20144,
        },
        header: {
          record_code: '01',
          bank_code: '30004',
          _1: '',
          desk_code: '00585',
          currency_code: 'EUR',
          nb_of_dec: '2',
          _2: '',
          account_nb: '00010156142',
          _3: '',
          prev_date: '2023-03-28',
          _4: '',
          prev_amount: '656482.79',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '30004',
          desk_code: '00585',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00010156142',
          next_date: '2023-03-29',
          next_amount: '636338.79',
        },
        transactions: [
          {
            record_code: '04',
            bank_code: '30004',
            internal_code: '0568',
            desk_code: '00585',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00010156142',
            operation_code: '18',
            operation_date: '2023-03-29',
            reject_code: '',
            value_date: '2023-03-29',
            label: 'DOMUSVI',
            _2: '',
            reference: '0000000',
            exempt_code: '',
            _3: '',
            amount: '35919',
            '_4:': '',
            debtor_name: 'DOMUSVI',
            remittance_information_1: '/INV/3867 8.2.2023',
            end2end_identification: 'NOTPROVIDED',
            purpose: '',
            PDO: 'FR FRANCE',
          },
          {
            record_code: '04',
            bank_code: '30004',
            internal_code: '0818',
            desk_code: '00585',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00010156142',
            operation_code: 'B2',
            operation_date: '2023-03-29',
            reject_code: '',
            value_date: '2023-03-29',
            label: 'PRLV SEPA/DGFIP IMPOT',
            _2: '',
            reference: '',
            exempt_code: '0',
            _3: '',
            amount: '-56063',
            '_4:': 'FR46ZZZ005002',
            creditor_name: 'DGFIP IMPOT',
            creditor_id: 'FR46ZZZ005002',
            creditor_id_type: '',
            mandate_identification: 'NN804148211DGFIP2019921505K41FN7QQ',
            sequence_type: '',
            end2end_identification: '220750510700113748308',
            purpose: '',
            remittance_information_1: 'TVA-032023-3310CA3',
          },
        ],
        problems: null,
      },
    ]);
  });

  test('Known bank', () => {
    const text = `0118020    00001EUR2 00410GXLT01  060423                                                  0000000012258N
0418020404100001EUR2 00410GXLT0121070423  050423VIREMENT BANCAIRE EN VOTRE FAVE  3175387 00000000594363K000070
0518020404100001EUR2 00410GXLT0121070423  050423URN 5335098    VIREMENT N 53350
0418020312600001EUR2 00410GXLT0167070423  050423TVA SUR PRECOMPTE DE COMM. DE F  3175387 00000000001429P000002
0518020312600001EUR2 00410GXLT0167070423  050423INANCEMENT   VIREMENT N 5335098
0718020    00001EUR2 00410GXLT01  070423                                                  0000000000000} `;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 1225.85,
          end: 0,
          start: -1225.85,
          transactions: 59579.29,
        },
        header: {
          record_code: '01',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410GXLT01',
          prev_date: '2023-04-06',
          prev_amount: '-1225.85',
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410GXLT01',
          next_date: '2023-04-07',
          next_amount: '0',
        },
        transactions: [
          {
            _1: '',
            _2: '050',
            _3: '0',
            '_4:': '000070',
            record_code: '04',
            bank_code: '18020',
            internal_code: '4041',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            account_nb: '00410GXLT01',
            operation_code: '21',
            operation_date: '2023-04-07',
            reject_code: '',
            amount: '-59436.32',
            exempt_code: '',
            label: 'VIREMENT BANCAIRE EN VOTRE FAVE',
            reference: '3175387',
            value_date: '2023-04-05',
            423: 'URN 5335098    VIREMENT N 53350',
          },
          {
            423: 'INANCEMENT   VIREMENT N 5335098',
            _1: '',
            _2: '050',
            _3: '0',
            '_4:': '000002',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3126',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            account_nb: '00410GXLT01',
            operation_code: '67',
            operation_date: '2023-04-07',
            reject_code: '',
            amount: '-142.97',
            exempt_code: '',
            label: 'TVA SUR PRECOMPTE DE COMM. DE F',
            reference: '3175387',
            value_date: '2023-04-05',
          },
        ],
        problems: [
          {
            message:
              "Sum of transactions (59579.29) doesn't match with difference between start amount -1225.85 and end amount 0",
          },
        ],
      },
    ]);
  });

  test('Known bank 2', () => {
    const text = `0118020    00001EUR2 00410GXLT01  030323                                                  0000000773178H
0418020404100001EUR2 00410GXLT0121060323  040323VIREMENT BANCAIRE EN VOTRE FAVE  2059801 00000000771083K000070
0518020404100001EUR2 00410GXLT0121060323  040323URN 5295341    VIREMENT N 52953
0418020312600001EUR2 00410GXLT0167060323  040323TVA SUR PRECOMPTE DE COMM. DE F  2059801 00000000000349L000002
0518020312600001EUR2 00410GXLT0167060323  040323INANCEMENT   VIREMENT N 5295341
0418020302600001EUR2 00410GXLT0161060323  040323PRECOMPTE DE COMM. DE FINANCEME  2059801 00000000001746L000001
0518020302600001EUR2 00410GXLT0161060323  040323NT   VIREMENT N 5295341
0718020    00001EUR2 00410GXLT01  060323                                                  0000000000000}
0118020    00001EUR2 00410GXLT11  030323                                                  0000025068056R
0418020464100001EUR2 00410GXLT1191060323  040323MONTANT AVIS DE CREDIT  PAYE PA  2059801 00000000389972L000077
0518020464100001EUR2 00410GXLT1191060323  040323R VIREMENT  5295341
0418020434100001EUR2 00410GXLT1191060323  150423MONTANT FINANCE  PAR VIREMENT 5  2059801 00000000381110R000028
0518020434100001EUR2 00410GXLT1191060323  150423295341
0418020312600001EUR2 00410GXLT1167060323  040323TVA SUR PRECOMPTE DE COMM. DE F  2059801 00000000000349L000013
0518020312600001EUR2 00410GXLT1167060323  040323INANCEMENT   VIREMENT N 5295341
0418020302600001EUR2 00410GXLT1161060323  040323PRECOMPTE DE COMM. DE FINANCEME  2059801 00000000001746L000009
0518020302600001EUR2 00410GXLT1161060323  040323NT   VIREMENT N 5295341
0718020    00001EUR2 00410GXLT11  060323                                                  0000025841235P                `;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 77317.88,
          end: 0,
          start: 77317.88,
          transactions: 77317.88,
        },
        header: {
          account_nb: '00410GXLT01',
          bank_code: '18020',
          currency_code: 'EUR',
          desk_code: '00001',
          nb_of_dec: '2',
          prev_amount: '77317.88',
          prev_date: '2023-03-03',
          record_code: '01',
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          account_nb: '00410GXLT01',
          bank_code: '18020',
          currency_code: 'EUR',
          desk_code: '00001',
          nb_of_dec: '2',
          next_amount: '0',
          next_date: '2023-03-06',
          record_code: '07',
        },
        transactions: [
          {
            323: 'URN 5295341    VIREMENT N 52953',
            _1: '',
            _2: '040',
            _3: '0',
            '_4:': '000070',
            account_nb: '00410GXLT01',
            amount: '-77108.32',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '4041',
            label: 'VIREMENT BANCAIRE EN VOTRE FAVE',
            nb_of_dec: '2',
            operation_code: '21',
            operation_date: '2023-03-06',
            record_code: '04',
            reference: '2059801',
            reject_code: '',
            value_date: '2023-03-04',
          },
          {
            323: 'INANCEMENT   VIREMENT N 5295341',
            _1: '',
            _2: '040',
            _3: '0',
            '_4:': '000002',
            account_nb: '00410GXLT01',
            amount: '-34.93',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '3126',
            label: 'TVA SUR PRECOMPTE DE COMM. DE F',
            nb_of_dec: '2',
            operation_code: '67',
            operation_date: '2023-03-06',
            record_code: '04',
            reference: '2059801',
            reject_code: '',
            value_date: '2023-03-04',
          },
          {
            323: 'NT   VIREMENT N 5295341',
            _1: '',
            _2: '040',
            _3: '0',
            '_4:': '000001',
            account_nb: '00410GXLT01',
            amount: '-174.63',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '3026',
            label: 'PRECOMPTE DE COMM. DE FINANCEME',
            nb_of_dec: '2',
            operation_code: '61',
            operation_date: '2023-03-06',
            record_code: '04',
            reference: '2059801',
            reject_code: '',
            value_date: '2023-03-04',
          },
        ],
        problems: null,
      },
      {
        amounts: {
          diff: 77317.88,
          end: -2584123.57,
          start: -2506805.69,
          transactions: 77317.88,
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          account_nb: '00410GXLT11',
          bank_code: '18020',
          currency_code: 'EUR',
          desk_code: '00001',
          nb_of_dec: '2',
          next_amount: '-2584123.57',
          next_date: '2023-03-06',
          record_code: '07',
        },
        header: {
          account_nb: '00410GXLT11',
          bank_code: '18020',
          currency_code: 'EUR',
          desk_code: '00001',
          nb_of_dec: '2',
          prev_amount: '-2506805.69',
          prev_date: '2023-03-03',
          record_code: '01',
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
        },
        problems: null,
        transactions: [
          {
            323: 'R VIREMENT  5295341',
            _1: '',
            _2: '040',
            _3: '0',
            '_4:': '000077',
            account_nb: '00410GXLT11',
            amount: '-38997.23',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '4641',
            label: 'MONTANT AVIS DE CREDIT  PAYE PA',
            nb_of_dec: '2',
            operation_code: '91',
            operation_date: '2023-03-06',
            record_code: '04',
            reference: '2059801',
            reject_code: '',
            value_date: '2023-03-04',
          },
          {
            423: '295341',
            _1: '',
            _2: '150',
            _3: '0',
            '_4:': '000028',
            account_nb: '00410GXLT11',
            amount: '-38111.09',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '4341',
            label: 'MONTANT FINANCE  PAR VIREMENT 5',
            nb_of_dec: '2',
            operation_code: '91',
            operation_date: '2023-03-06',
            record_code: '04',
            reference: '2059801',
            reject_code: '',
            value_date: '2023-04-15',
          },
          {
            323: 'INANCEMENT   VIREMENT N 5295341',
            _1: '',
            _2: '040',
            _3: '0',
            '_4:': '000013',
            account_nb: '00410GXLT11',
            amount: '-34.93',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '3126',
            label: 'TVA SUR PRECOMPTE DE COMM. DE F',
            nb_of_dec: '2',
            operation_code: '67',
            operation_date: '2023-03-06',
            record_code: '04',
            reference: '2059801',
            reject_code: '',
            value_date: '2023-03-04',
          },
          {
            323: 'NT   VIREMENT N 5295341',
            _1: '',
            _2: '040',
            _3: '0',
            '_4:': '000009',
            account_nb: '00410GXLT11',
            amount: '-174.63',
            bank_code: '18020',
            currency_code: 'EUR',
            desk_code: '00001',
            exempt_code: '',
            internal_code: '3026',
            label: 'PRECOMPTE DE COMM. DE FINANCEME',
            nb_of_dec: '2',
            operation_code: '61',
            operation_date: '2023-03-06',
            record_code: '04',
            reference: '2059801',
            reject_code: '',
            value_date: '2023-03-04',
          },
        ],
      },
    ]);
  });

  test('Known bank 3 - no transactions', () => {
    const text = `0118020    00001EUR2 00410GXLT01  210323                                                  0000000000000}
0718020    00001EUR2 00410GXLT01  220323                                                  0000000000000}
0118020    00001EUR2 00410GXLT11  210323                                                  0000019966371M
0718020    00001EUR2 00410GXLT11  220323                                                  0000019966371M                `;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 0,
          end: 0,
          start: 0,
          transactions: 0,
        },
        header: {
          record_code: '01',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410GXLT01',
          prev_date: '2023-03-21',
          prev_amount: '0',
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410GXLT01',
          next_date: '2023-03-22',
          next_amount: '0',
        },
        transactions: [],
        problems: null,
      },
      {
        amounts: {
          diff: 0,
          end: -1996637.14,
          start: -1996637.14,
          transactions: 0,
        },
        header: {
          record_code: '01',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410GXLT11',
          prev_date: '2023-03-21',
          prev_amount: '-1996637.14',
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410GXLT11',
          next_date: '2023-03-22',
          next_amount: '-1996637.14',
        },
        transactions: [],
        problems: null,
      },
    ]);
  });

  test('unknown bank - missed lines', () => {
    const text = `0118020    00001EUR2 00410FVXE01  300623                                                  0000000551132H
0418020312900001EUR2 00410FVXE0167030723  300623TVA SUR FRAIS D AVIS DE LITIG M  6018370 00000000000231}000002
0518020312900001EUR2 00410FVXE0167030723  300623OIS DE JUIN 2023
0418020302900001EUR2 00410FVXE0165030723  300623FRAIS D AVIS DE LITIG MOIS DE J  6018370 00000000001155}000001
0518020302900001EUR2 00410FVXE0165030723  300623UIN 2023
0418020312800001EUR2 00410FVXE0167030723  300623TVA SUR FRAIS DEMANDE D AGREMEN  6018369 00000000000320}000002
0518020312800001EUR2 00410FVXE0167030723  300623T PERIODE   JUIN 2023
0418020302800001EUR2 00410FVXE0165030723  300623FRAIS DEMANDE D AGREMENT PERIOD  6018369 00000000001600}000001
0518020302800001EUR2 00410FVXE0165030723  300623E   JUIN 2023
0418020505100001EUR2 00410FVXE0105030723  070723VIREMENT RECU  FACTURE N F2023-  6015954 00000000124860{000001
0518020505100001EUR2 00410FVXE0105030723  0707230335 ASCENS PARIS
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0504 GARANTIE DEV  6003520 00000000138600{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0467 GARANTIE DEV  6003518 00000000187440{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0461 GARANTIE DEV  6003517 00000000153000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0462 GARANTIE DEV  6003515 00000000051000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0489 GARANTIE DEV  6003513 00000000063000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0506 GARANTIE DEV  6003511 00000000259440{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0508 GARANTIE DEV  6003463 00000000516000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0513 GARANTIE DEV  6003458 00000000205920{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0476 GARANTIE DEV  6003456 00000000155760{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE EGIS
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0483 GARANTIE DEV  6003451 00000000105537H000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0469 GARANTIE DEV  6003444 00000000085800{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE B INF
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0486 GARANTIE DEV  6003443 00000000156000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALAIN
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0517 GARANTIE DEV  6003433 00000000000760F000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0485 GARANTIE DEV  6003417 00000000166800{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE QUADI
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0509 GARANTIE DEV  6003410 00000000141780{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE QUADI
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0474 GARANTIE DEV  6003403 00000000142560{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0495 GARANTIE DEV  6003398 00000000136740{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0525 GARANTIE DEV  6003389 00000000097200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE CHRON
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0520 GARANTIE DEV  6003382 00000000153600{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE B INF
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0526 GARANTIE DEV  6003377 00000000132000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE B INF
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0521 GARANTIE DEV  6003360 00000000122400{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE AUTOD
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0472 GARANTIE DEV  6003354 00000000114000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALTUR
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0496 GARANTIE DEV  6003349 00000000137280{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALTUR
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0487 GARANTIE DEV  6003342 00000000206700{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE ALAIN
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0454 GARANTIE DEV  6003328 00000000115200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0460 GARANTIE DEV  6003327 00000000124800{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0498 GARANTIE DEV  6003322 00000000115200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0491 GARANTIE DEV  6003315 00000000153000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0522 GARANTIE DEV  6003309 00000000072000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0463 GARANTIE DEV  6003304 00000000151680{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0464 GARANTIE DEV  6003297 00000000142200{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE SAFRA
0418020210300001EUR2 00410FVXE0191030723  030723FACTURE F2023-0507 GARANTIE DEV  6003264 00000000516000{000001
0518020210300001EUR2 00410FVXE0191030723  030723ENANT FINANCABLE GARANTIE REGIE
0418020404100001EUR2 00410FVXE0121030723  010723VIREMENT BANCAIRE EN VOTRE FAVE  5994113 00000003000000}000070
0518020404100001EUR2 00410FVXE0121030723  010723URN 5441552    VIREMENT N 54415
0418020312600001EUR2 00410FVXE0167030723  010723TVA SUR PRECOMPTE DE COMM. DE F  5994113 00000000007358R000002
0518020312600001EUR2 00410FVXE0167030723  010723INANCEMENT   VIREMENT N 5441552
0418020302600001EUR2 00410FVXE0161030723  010723PRECOMPTE DE COMM. DE FINANCEME  5994113 00000000036794P000001
0518020302600001EUR2 00410FVXE0161030723  010723NT   VIREMENT N 5441552
0418020608100001EUR2 00410FVXE0191030723  030723PRELEVEMENT DE FG 20.00P SUR RE  5979041 00000001691756R000073
0518020608100001EUR2 00410FVXE0191030723  030723MISE N 2793426
0418020101100001EUR2 00410FVXE0191030723  030723REPRISE DE FACTURES INDISPONIBL  5979041 00000008032515Q000004
0518020101100001EUR2 00410FVXE0191030723  030723ES  REMISE N 2793426
0418020303100001EUR2 00410FVXE0167030723  030723TVA SUR COMMISSION D AFFACTURAG  5979041 00000000006628J000003
0518020303100001EUR2 00410FVXE0167030723  030723E SUR REMISE N 2793426
0418020302100001EUR2 00410FVXE0165030723  030723COMMISSION D AFFACTURAGE SUR RE  5979041 00000000033140N000002
0518020302100001EUR2 00410FVXE0165030723  030723MISE N 2793426
0418020100100001EUR2 00410FVXE0191030723  030723ACHAT REMISE DE FACTURES  REMIS  5979041 00000011835978{000001
0518020100100001EUR2 00410FVXE0191030723  030723E N 2793426
0418020353600001EUR2 00410FVXE0167010723  010723TVA SUR COMM. DE FINANCEMENT CO  5952864 00000000005282Q000002
0518020353600001EUR2 00410FVXE0167010723  010723MPLEMENTAIRE ARRETES DE LA PERI
0418020352600001EUR2 00410FVXE0161010723  010723COMM. DE FINANCEMENT COMPLEMENT  5952864 00000000026414K000001
0518020352600001EUR2 00410FVXE0161010723  010723AIRE ARRETES DE LA PERIODE 2023
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023-0406 DEVENANT F  5950621 00000000159840{000001
0518020210700001EUR2 00410FVXE0191010723  010723INANCABLE GARANTIE  DEBITEUR RE
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023-0407 DEVENANT F  5950620 00000000125400{000001
0518020210700001EUR2 00410FVXE0191010723  010723INANCABLE GARANTIE  DEBITEUR RE
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023--0408 DEVENANT   5950618 00000000164736{000001
0518020210700001EUR2 00410FVXE0191010723  010723FINANCABLE GARANTIE  DEBITEUR R
0418020210700001EUR2 00410FVXE0191010723  010723FACTURE N F2023-0409 DEVENANT F  5950616 00000000050544{000001
0518020210700001EUR2 00410FVXE0191010723  010723INANCABLE GARANTIE  DEBITEUR RE
041802036BZ00001EUR2 00410FVXE01  010723  010723TVA SUR FRAIS DE GESTION DE CON  5950217 00000000000080}000002
051802036BZ00001EUR2 00410FVXE01  010723  010723TRAT EN LIGNE
041802032BZ00001EUR2 00410FVXE01  010723  010723FRAIS DE GESTION DE CONTRAT EN   5950217 00000000000400}000001
051802032BZ00001EUR2 00410FVXE01  010723  010723LIGNE
0718020    00001EUR2 00410FVXE01  030723                                                  0000005188211C
0118020    00001EUR2 00410FVXE11  300623                                                  0000022430685}
0418020312900001EUR2 00410FVXE1167030723  300623TVA SUR FRAIS D AVIS DE LITIG M  6018370 00000000000231}000006
0518020312900001EUR2 00410FVXE1167030723  300623OIS DE JUIN 2023
0418020302900001EUR2 00410FVXE1165030723  300623FRAIS D AVIS DE LITIG MOIS DE J  6018370 00000000001155}000005
0518020302900001EUR2 00410FVXE1165030723  300623UIN 2023
0418020312800001EUR2 00410FVXE1167030723  300623TVA SUR FRAIS DEMANDE D AGREMEN  6018369 00000000000320}000006
0518020312800001EUR2 00410FVXE1167030723  300623T PERIODE   JUIN 2023
0418020302800001EUR2 00410FVXE1165030723  300623FRAIS DEMANDE D AGREMENT PERIOD  6018369 00000000001600}000005
0518020302800001EUR2 00410FVXE1165030723  300623E   JUIN 2023
0418020505100001EUR2 00410FVXE1105030723  070723VIREMENT RECU  FACTURE N F2023-  6015954 00000000145920{000005
0518020505100001EUR2 00410FVXE1105030723  0707230335 ASCENS PARIS
0418020454100001EUR2 00410FVXE1191030723  010723MONTANT AVIS DE DEBIT  SOUSTRAI  5994113 00000001807856A000075
0518020454100001EUR2 00410FVXE1191030723  010723T DU FINANCEMENT VIREMENT  5441
0418020434100001EUR2 00410FVXE1191030723  210823MONTANT FINANCE  PAR VIREMENT 5  5994113 00000004807856J000028
0518020434100001EUR2 00410FVXE1191030723  210823441552
0418020312600001EUR2 00410FVXE1167030723  010723TVA SUR PRECOMPTE DE COMM. DE F  5994113 00000000007358R000013
0518020312600001EUR2 00410FVXE1167030723  010723INANCEMENT   VIREMENT N 5441552
0418020302600001EUR2 00410FVXE1161030723  010723PRECOMPTE DE COMM. DE FINANCEME  5994113 00000000036794P000009
0518020302600001EUR2 00410FVXE1161030723  010723NT   VIREMENT N 5441552
0418020505100001EUR2 00410FVXE1105030723  070723VIREMENT RECU  FACTURE N F2023-  5988580 00000000142800{000005
0518020505100001EUR2 00410FVXE1105030723  0707230334 ALAIN AFFLELOU FRANCHISEUR
0418020608100001EUR2 00410FVXE1191030723  030723PRELEVEMENT DE FG 20.00P SUR RE  5979041 00000001691756R000075
0518020608100001EUR2 00410FVXE1191030723  030723MISE N 2793426
0418020303100001EUR2 00410FVXE1167030723  030723TVA SUR COMMISSION D AFFACTURAG  5979041 00000000006628J000012
0518020303100001EUR2 00410FVXE1167030723  030723E SUR REMISE N 2793426
0418020302100001EUR2 00410FVXE1165030723  030723COMMISSION D AFFACTURAGE SUR RE  5979041 00000000033140N000011
0518020302100001EUR2 00410FVXE1165030723  030723MISE N 2793426
0418020353600001EUR2 00410FVXE1167010723  010723TVA SUR COMM. DE FINANCEMENT CO  5952864 00000000005282Q000006
0518020353600001EUR2 00410FVXE1167010723  010723MPLEMENTAIRE ARRETES DE LA PERI
0418020352600001EUR2 00410FVXE1161010723  010723COMM. DE FINANCEMENT COMPLEMENT  5952864 00000000026414K000005
0518020352600001EUR2 00410FVXE1161010723  010723AIRE ARRETES DE LA PERIODE 2023
041802036BZ00001EUR2 00410FVXE11  010723  010723TVA SUR FRAIS DE GESTION DE CON  5950217 00000000000080}000006
051802036BZ00001EUR2 00410FVXE11  010723  010723TRAT EN LIGNE
041802032BZ00001EUR2 00410FVXE11  010723  010723FRAIS DE GESTION DE CONTRAT EN   5950217 00000000000400}000005
051802032BZ00001EUR2 00410FVXE11  010723  010723LIGNE
0718020    00001EUR2 00410FVXE11  030723                                                  0000026953127J

`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 463707.85,
          end: 518821.13,
          start: 55113.28,
          transactions: 463707.85,
        },
        header: {
          record_code: '01',
          bank_code: '18020',
          _1: '',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          _2: '',
          account_nb: '00410FVXE01',
          _3: '',
          prev_date: '2023-06-30',
          _4: '',
          prev_amount: '55113.28',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410FVXE01',
          next_date: '2023-07-03',
          next_amount: '518821.13',
        },
        transactions: [
          {
            623: 'OIS DE JUIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3129',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'TVA SUR FRAIS D AVIS DE LITIG M',
            _2: '300',
            reference: '6018370',
            exempt_code: '',
            _3: '0',
            amount: '-23.1',
            '_4:': '000002',
          },
          {
            623: 'UIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3029',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '65',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'FRAIS D AVIS DE LITIG MOIS DE J',
            _2: '300',
            reference: '6018370',
            exempt_code: '',
            _3: '0',
            amount: '-115.5',
            '_4:': '000001',
          },
          {
            623: 'T PERIODE   JUIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3128',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'TVA SUR FRAIS DEMANDE D AGREMEN',
            _2: '300',
            reference: '6018369',
            exempt_code: '',
            _3: '0',
            amount: '-32',
            '_4:': '000002',
          },
          {
            623: 'E   JUIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3028',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '65',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'FRAIS DEMANDE D AGREMENT PERIOD',
            _2: '300',
            reference: '6018369',
            exempt_code: '',
            _3: '0',
            amount: '-160',
            '_4:': '000001',
          },
          {
            723: '0335 ASCENS PARIS',
            record_code: '04',
            bank_code: '18020',
            internal_code: '5051',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '05',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-07',
            label: 'VIREMENT RECU  FACTURE N F2023-',
            _2: '070',
            reference: '6015954',
            exempt_code: '',
            _3: '0',
            amount: '12486',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0504 GARANTIE DEV',
            _2: '030',
            reference: '6003520',
            exempt_code: '',
            _3: '0',
            amount: '13860',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE REGIE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0467 GARANTIE DEV',
            _2: '030',
            reference: '6003518',
            exempt_code: '',
            _3: '0',
            amount: '18744',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0461 GARANTIE DEV',
            _2: '030',
            reference: '6003517',
            exempt_code: '',
            _3: '0',
            amount: '15300',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0462 GARANTIE DEV',
            _2: '030',
            reference: '6003515',
            exempt_code: '',
            _3: '0',
            amount: '5100',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0489 GARANTIE DEV',
            _2: '030',
            reference: '6003513',
            exempt_code: '',
            _3: '0',
            amount: '6300',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE REGIE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0506 GARANTIE DEV',
            _2: '030',
            reference: '6003511',
            exempt_code: '',
            _3: '0',
            amount: '25944',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE REGIE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0508 GARANTIE DEV',
            _2: '030',
            reference: '6003463',
            exempt_code: '',
            _3: '0',
            amount: '51600',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE REGIE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0513 GARANTIE DEV',
            _2: '030',
            reference: '6003458',
            exempt_code: '',
            _3: '0',
            amount: '20592',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE EGIS',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0476 GARANTIE DEV',
            _2: '030',
            reference: '6003456',
            exempt_code: '',
            _3: '0',
            amount: '15576',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE CHRON',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0483 GARANTIE DEV',
            _2: '030',
            reference: '6003451',
            exempt_code: '',
            _3: '0',
            amount: '10553.78',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE B INF',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0469 GARANTIE DEV',
            _2: '030',
            reference: '6003444',
            exempt_code: '',
            _3: '0',
            amount: '8580',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE ALAIN',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0486 GARANTIE DEV',
            _2: '030',
            reference: '6003443',
            exempt_code: '',
            _3: '0',
            amount: '15600',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE REGIE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0517 GARANTIE DEV',
            _2: '030',
            reference: '6003433',
            exempt_code: '',
            _3: '0',
            amount: '76.06',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE QUADI',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0485 GARANTIE DEV',
            _2: '030',
            reference: '6003417',
            exempt_code: '',
            _3: '0',
            amount: '16680',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE QUADI',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0509 GARANTIE DEV',
            _2: '030',
            reference: '6003410',
            exempt_code: '',
            _3: '0',
            amount: '14178',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE CHRON',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0474 GARANTIE DEV',
            _2: '030',
            reference: '6003403',
            exempt_code: '',
            _3: '0',
            amount: '14256',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE CHRON',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0495 GARANTIE DEV',
            _2: '030',
            reference: '6003398',
            exempt_code: '',
            _3: '0',
            amount: '13674',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE CHRON',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0525 GARANTIE DEV',
            _2: '030',
            reference: '6003389',
            exempt_code: '',
            _3: '0',
            amount: '9720',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE B INF',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0520 GARANTIE DEV',
            _2: '030',
            reference: '6003382',
            exempt_code: '',
            _3: '0',
            amount: '15360',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE B INF',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0526 GARANTIE DEV',
            _2: '030',
            reference: '6003377',
            exempt_code: '',
            _3: '0',
            amount: '13200',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE AUTOD',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0521 GARANTIE DEV',
            _2: '030',
            reference: '6003360',
            exempt_code: '',
            _3: '0',
            amount: '12240',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE ALTUR',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0472 GARANTIE DEV',
            _2: '030',
            reference: '6003354',
            exempt_code: '',
            _3: '0',
            amount: '11400',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE ALTUR',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0496 GARANTIE DEV',
            _2: '030',
            reference: '6003349',
            exempt_code: '',
            _3: '0',
            amount: '13728',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE ALAIN',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0487 GARANTIE DEV',
            _2: '030',
            reference: '6003342',
            exempt_code: '',
            _3: '0',
            amount: '20670',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0454 GARANTIE DEV',
            _2: '030',
            reference: '6003328',
            exempt_code: '',
            _3: '0',
            amount: '11520',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0460 GARANTIE DEV',
            _2: '030',
            reference: '6003327',
            exempt_code: '',
            _3: '0',
            amount: '12480',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0498 GARANTIE DEV',
            _2: '030',
            reference: '6003322',
            exempt_code: '',
            _3: '0',
            amount: '11520',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0491 GARANTIE DEV',
            _2: '030',
            reference: '6003315',
            exempt_code: '',
            _3: '0',
            amount: '15300',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0522 GARANTIE DEV',
            _2: '030',
            reference: '6003309',
            exempt_code: '',
            _3: '0',
            amount: '7200',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0463 GARANTIE DEV',
            _2: '030',
            reference: '6003304',
            exempt_code: '',
            _3: '0',
            amount: '15168',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE SAFRA',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0464 GARANTIE DEV',
            _2: '030',
            reference: '6003297',
            exempt_code: '',
            _3: '0',
            amount: '14220',
            '_4:': '000001',
          },
          {
            723: 'ENANT FINANCABLE GARANTIE REGIE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2103',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'FACTURE F2023-0507 GARANTIE DEV',
            _2: '030',
            reference: '6003264',
            exempt_code: '',
            _3: '0',
            amount: '51600',
            '_4:': '000001',
          },
          {
            723: 'URN 5441552    VIREMENT N 54415',
            record_code: '04',
            bank_code: '18020',
            internal_code: '4041',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '21',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'VIREMENT BANCAIRE EN VOTRE FAVE',
            _2: '010',
            reference: '5994113',
            exempt_code: '',
            _3: '0',
            amount: '-300000',
            '_4:': '000070',
          },
          {
            723: 'INANCEMENT   VIREMENT N 5441552',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3126',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'TVA SUR PRECOMPTE DE COMM. DE F',
            _2: '010',
            reference: '5994113',
            exempt_code: '',
            _3: '0',
            amount: '-735.89',
            '_4:': '000002',
          },
          {
            723: 'NT   VIREMENT N 5441552',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3026',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '61',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'PRECOMPTE DE COMM. DE FINANCEME',
            _2: '010',
            reference: '5994113',
            exempt_code: '',
            _3: '0',
            amount: '-3679.47',
            '_4:': '000001',
          },
          {
            723: 'MISE N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '6081',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'PRELEVEMENT DE FG 20.00P SUR RE',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '-169175.69',
            '_4:': '000073',
          },
          {
            723: 'ES  REMISE N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '1011',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'REPRISE DE FACTURES INDISPONIBL',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '-803251.58',
            '_4:': '000004',
          },
          {
            723: 'E SUR REMISE N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3031',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'TVA SUR COMMISSION D AFFACTURAG',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '-662.81',
            '_4:': '000003',
          },
          {
            723: 'MISE N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3021',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '65',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'COMMISSION D AFFACTURAGE SUR RE',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '-3314.05',
            '_4:': '000002',
          },
          {
            723: 'E N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '1001',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'ACHAT REMISE DE FACTURES  REMIS',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '1183597.8',
            '_4:': '000001',
          },
          {
            723: 'MPLEMENTAIRE ARRETES DE LA PERI',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3536',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '67',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'TVA SUR COMM. DE FINANCEMENT CO',
            _2: '010',
            reference: '5952864',
            exempt_code: '',
            _3: '0',
            amount: '-528.28',
            '_4:': '000002',
          },
          {
            723: 'AIRE ARRETES DE LA PERIODE 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3526',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '61',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'COMM. DE FINANCEMENT COMPLEMENT',
            _2: '010',
            reference: '5952864',
            exempt_code: '',
            _3: '0',
            amount: '-2641.42',
            '_4:': '000001',
          },
          {
            723: 'INANCABLE GARANTIE  DEBITEUR RE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2107',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'FACTURE N F2023-0406 DEVENANT F',
            _2: '010',
            reference: '5950621',
            exempt_code: '',
            _3: '0',
            amount: '15984',
            '_4:': '000001',
          },
          {
            723: 'INANCABLE GARANTIE  DEBITEUR RE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2107',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'FACTURE N F2023-0407 DEVENANT F',
            _2: '010',
            reference: '5950620',
            exempt_code: '',
            _3: '0',
            amount: '12540',
            '_4:': '000001',
          },
          {
            723: 'FINANCABLE GARANTIE  DEBITEUR R',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2107',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'FACTURE N F2023--0408 DEVENANT',
            _2: '010',
            reference: '5950618',
            exempt_code: '',
            _3: '0',
            amount: '16473.6',
            '_4:': '000001',
          },
          {
            723: 'INANCABLE GARANTIE  DEBITEUR RE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '2107',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '91',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'FACTURE N F2023-0409 DEVENANT F',
            _2: '010',
            reference: '5950616',
            exempt_code: '',
            _3: '0',
            amount: '5054.4',
            '_4:': '000001',
          },
          {
            723: 'TRAT EN LIGNE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '36BZ',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'TVA SUR FRAIS DE GESTION DE CON',
            _2: '010',
            reference: '5950217',
            exempt_code: '',
            _3: '0',
            amount: '-8',
            '_4:': '000002',
          },
          {
            723: 'LIGNE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '32BZ',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE01',
            operation_code: '',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'FRAIS DE GESTION DE CONTRAT EN',
            _2: '010',
            reference: '5950217',
            exempt_code: '',
            _3: '0',
            amount: '-40',
            '_4:': '000001',
          },
        ],
        problems: null,
      },
      {
        amounts: {
          diff: 452244.21,
          end: -2695312.71,
          start: -2243068.5,
          transactions: 452244.21,
        },
        header: {
          record_code: '01',
          bank_code: '18020',
          _1: '',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          _2: '',
          account_nb: '00410FVXE11',
          _3: '',
          prev_date: '2023-06-30',
          _4: '',
          prev_amount: '-2243068.5',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '18020',
          desk_code: '00001',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00410FVXE11',
          next_date: '2023-07-03',
          next_amount: '-2695312.71',
        },
        transactions: [
          {
            623: 'OIS DE JUIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3129',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'TVA SUR FRAIS D AVIS DE LITIG M',
            _2: '300',
            reference: '6018370',
            exempt_code: '',
            _3: '0',
            amount: '-23.1',
            '_4:': '000006',
          },
          {
            623: 'UIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3029',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '65',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'FRAIS D AVIS DE LITIG MOIS DE J',
            _2: '300',
            reference: '6018370',
            exempt_code: '',
            _3: '0',
            amount: '-115.5',
            '_4:': '000005',
          },
          {
            623: 'T PERIODE   JUIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3128',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'TVA SUR FRAIS DEMANDE D AGREMEN',
            _2: '300',
            reference: '6018369',
            exempt_code: '',
            _3: '0',
            amount: '-32',
            '_4:': '000006',
          },
          {
            623: 'E   JUIN 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3028',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '65',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-06-30',
            label: 'FRAIS DEMANDE D AGREMENT PERIOD',
            _2: '300',
            reference: '6018369',
            exempt_code: '',
            _3: '0',
            amount: '-160',
            '_4:': '000005',
          },
          {
            723: '0335 ASCENS PARIS',
            record_code: '04',
            bank_code: '18020',
            internal_code: '5051',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '05',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-07',
            label: 'VIREMENT RECU  FACTURE N F2023-',
            _2: '070',
            reference: '6015954',
            exempt_code: '',
            _3: '0',
            amount: '14592',
            '_4:': '000005',
          },
          {
            723: 'T DU FINANCEMENT VIREMENT  5441',
            record_code: '04',
            bank_code: '18020',
            internal_code: '4541',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'MONTANT AVIS DE DEBIT  SOUSTRAI',
            _2: '010',
            reference: '5994113',
            exempt_code: '',
            _3: '0',
            amount: '180785.61',
            '_4:': '000075',
          },
          {
            823: '441552',
            record_code: '04',
            bank_code: '18020',
            internal_code: '4341',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-08-21',
            label: 'MONTANT FINANCE  PAR VIREMENT 5',
            _2: '210',
            reference: '5994113',
            exempt_code: '',
            _3: '0',
            amount: '-480785.61',
            '_4:': '000028',
          },
          {
            723: 'INANCEMENT   VIREMENT N 5441552',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3126',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'TVA SUR PRECOMPTE DE COMM. DE F',
            _2: '010',
            reference: '5994113',
            exempt_code: '',
            _3: '0',
            amount: '-735.89',
            '_4:': '000013',
          },
          {
            723: 'NT   VIREMENT N 5441552',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3026',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '61',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'PRECOMPTE DE COMM. DE FINANCEME',
            _2: '010',
            reference: '5994113',
            exempt_code: '',
            _3: '0',
            amount: '-3679.47',
            '_4:': '000009',
          },
          {
            723: '0334 ALAIN AFFLELOU FRANCHISEUR',
            record_code: '04',
            bank_code: '18020',
            internal_code: '5051',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '05',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-07',
            label: 'VIREMENT RECU  FACTURE N F2023-',
            _2: '070',
            reference: '5988580',
            exempt_code: '',
            _3: '0',
            amount: '14280',
            '_4:': '000005',
          },
          {
            723: 'MISE N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '6081',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '91',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'PRELEVEMENT DE FG 20.00P SUR RE',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '-169175.69',
            '_4:': '000075',
          },
          {
            723: 'E SUR REMISE N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3031',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '67',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'TVA SUR COMMISSION D AFFACTURAG',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '-662.81',
            '_4:': '000012',
          },
          {
            723: 'MISE N 2793426',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3021',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '65',
            operation_date: '2023-07-03',
            reject_code: '',
            value_date: '2023-07-03',
            label: 'COMMISSION D AFFACTURAGE SUR RE',
            _2: '030',
            reference: '5979041',
            exempt_code: '',
            _3: '0',
            amount: '-3314.05',
            '_4:': '000011',
          },
          {
            723: 'MPLEMENTAIRE ARRETES DE LA PERI',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3536',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '67',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'TVA SUR COMM. DE FINANCEMENT CO',
            _2: '010',
            reference: '5952864',
            exempt_code: '',
            _3: '0',
            amount: '-528.28',
            '_4:': '000006',
          },
          {
            723: 'AIRE ARRETES DE LA PERIODE 2023',
            record_code: '04',
            bank_code: '18020',
            internal_code: '3526',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '61',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'COMM. DE FINANCEMENT COMPLEMENT',
            _2: '010',
            reference: '5952864',
            exempt_code: '',
            _3: '0',
            amount: '-2641.42',
            '_4:': '000005',
          },
          {
            723: 'TRAT EN LIGNE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '36BZ',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'TVA SUR FRAIS DE GESTION DE CON',
            _2: '010',
            reference: '5950217',
            exempt_code: '',
            _3: '0',
            amount: '-8',
            '_4:': '000006',
          },
          {
            723: 'LIGNE',
            record_code: '04',
            bank_code: '18020',
            internal_code: '32BZ',
            desk_code: '00001',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00410FVXE11',
            operation_code: '',
            operation_date: '2023-07-01',
            reject_code: '',
            value_date: '2023-07-01',
            label: 'FRAIS DE GESTION DE CONTRAT EN',
            _2: '010',
            reference: '5950217',
            exempt_code: '',
            _3: '0',
            amount: '-40',
            '_4:': '000005',
          },
        ],
        problems: null,
      },
    ]);
  });

  test('internal_code and operation code can be empty under conditions', () => {
    const text = `0130004    00585EUR2 00010156142  280323                                                  0000006564827I
0430004056800585EUR2 00010156142  290323  290323ABCDEFG                          0000000  0000000000000{
0430004    00585EUR2 0001015614218290323  290323ABCDEFG                          0000000  0000000000000{
0430004    00585EUR2 00010156142  290323  290323ABCDEFG                          0000000  0000000000000{
0730004    00585EUR2 00010156142  290323                                                  0000006564827I`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          diff: 0,
          end: 656482.79,
          start: 656482.79,
          transactions: 0,
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          account_nb: '00010156142',
          bank_code: '30004',
          currency_code: 'EUR',
          desk_code: '00585',
          nb_of_dec: '2',
          next_amount: '656482.79',
          next_date: '2023-03-29',
          record_code: '07',
        },
        header: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          account_nb: '00010156142',
          bank_code: '30004',
          currency_code: 'EUR',
          desk_code: '00585',
          nb_of_dec: '2',
          prev_amount: '656482.79',
          prev_date: '2023-03-28',
          record_code: '01',
        },
        transactions: [
          {
            _1: '',
            _2: '',
            _3: '',
            '_4:': '',
            account_nb: '00010156142',
            amount: '0',
            bank_code: '30004',
            currency_code: 'EUR',
            desk_code: '00585',
            exempt_code: '',
            internal_code: '0568',
            label: 'ABCDEFG',
            nb_of_dec: '2',
            operation_code: '',
            operation_date: '2023-03-29',
            record_code: '04',
            reference: '0000000',
            reject_code: '',
            value_date: '2023-03-29',
          },
          {
            _1: '',
            _2: '',
            _3: '',
            '_4:': '',
            account_nb: '00010156142',
            amount: '0',
            bank_code: '30004',
            currency_code: 'EUR',
            desk_code: '00585',
            exempt_code: '',
            internal_code: '',
            label: 'ABCDEFG',
            nb_of_dec: '2',
            operation_code: '18',
            operation_date: '2023-03-29',
            record_code: '04',
            reference: '0000000',
            reject_code: '',
            value_date: '2023-03-29',
          },
          {
            _1: '',
            _2: '',
            _3: '',
            '_4:': '',
            account_nb: '00010156142',
            amount: '0',
            bank_code: '30004',
            currency_code: 'EUR',
            desk_code: '00585',
            exempt_code: '',
            internal_code: '',
            label: 'ABCDEFG',
            nb_of_dec: '2',
            operation_code: '',
            operation_date: '2023-03-29',
            record_code: '04',
            reference: '0000000',
            reject_code: '',
            value_date: '2023-03-29',
          },
        ],
        problems: null,
      },
    ]);
  });

  test('various 2', () => {
    const text = `0130003    03328EUR2 00020409333  140723                                                  0000000001072G
0430003740003328EUR2 000204093336215072300130723ENT SEPA RECU                    00000001 0000000000000RFRAIS VIREM
0530003740003328EUR2 0002040933362150723     LIBREF 1380896458S
0530003740003328EUR2 0002040933362150723     LIBDE 23 23 EUR DU 13/07/23
0430003661003328EUR2 000204093332817072300170723CARTE X0154 15/07 TYPEFORM  S.L  00010000 0000000001068}.
0530003661003328EUR2 0002040933328170723     LIBCOMMERCE ELECTRONIQUE
0730003    03328EUR2 00020409333  170723                                                  0000000000003H`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          start: 107.27,
          end: 0.38,
          diff: 106.89,
          transactions: 106.89,
        },
        header: {
          record_code: '01',
          bank_code: '30003',
          _1: '',
          desk_code: '03328',
          currency_code: 'EUR',
          nb_of_dec: '2',
          _2: '',
          account_nb: '00020409333',
          _3: '',
          prev_date: '2023-07-14',
          _4: '',
          prev_amount: '107.27',
          _5: '',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '30003',
          desk_code: '03328',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '00020409333',
          next_date: '2023-07-17',
          next_amount: '0.38',
        },
        transactions: [
          {
            record_code: '04',
            bank_code: '30003',
            internal_code: '7400',
            desk_code: '03328',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00020409333',
            operation_code: '62',
            operation_date: '2023-07-15',
            reject_code: '00',
            value_date: '2023-07-13',
            label: 'ENT SEPA RECU',
            _2: '',
            reference: '0000000',
            exempt_code: '1',
            _3: '',
            amount: '-0.09',
            '_4:': 'FRAIS VIREM',
            label_1: 'REF 1380896458S',
            label_2: 'DE 23 23 EUR DU 13/07/23',
          },
          {
            record_code: '04',
            bank_code: '30003',
            internal_code: '6610',
            desk_code: '03328',
            currency_code: 'EUR',
            nb_of_dec: '2',
            _1: '',
            account_nb: '00020409333',
            operation_code: '28',
            operation_date: '2023-07-17',
            reject_code: '00',
            value_date: '2023-07-17',
            label: 'CARTE X0154 15/07 TYPEFORM  S.L',
            _2: '',
            reference: '0001000',
            exempt_code: '0',
            _3: '',
            amount: '-106.8',
            '_4:': '.',
            label_1: 'COMMERCE ELECTRONIQUE',
          },
        ],
        problems: null,
      },
    ]);
  });

  test('various 3', () => {
    const text = `0112206    04400EUR2 56022698740  160224        ** PAS DE MOUVEMENT CE JOUR **            0000000000000{  035
0712206    04400EUR2 56022698740  190224        ------------------------------            0000000000000{`;

    expect(parse(text)).toEqual([
      {
        amounts: {
          start: 0,
          diff: 0,
          end: 0,
          transactions: 0,
        },
        header: {
          record_code: '01',
          bank_code: '12206',
          _1: '',
          desk_code: '04400',
          currency_code: 'EUR',
          nb_of_dec: '2',
          _2: '',
          account_nb: '56022698740',
          _3: '',
          prev_date: '2024-02-16',
          _4: '** PAS DE MOUVEMENT CE JOUR **',
          prev_amount: '0',
          _5: '035',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '------------------------------',
          _5: '',
          record_code: '07',
          bank_code: '12206',
          desk_code: '04400',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '56022698740',
          next_date: '2024-02-19',
          next_amount: '0',
        },
        transactions: [],
        problems: null,
      },
    ]);
  });

  test('no line breaks', () => {
    const text = `0117406    00283EUR2 65041564965  060324                                                  0000001071841C  047           0417406000200283EUR2E6504156496502070324  070324REMISE CHQ 6316889 RANDOM PILES  6316889100000000008252{                0717406    00283EUR2 65041564965  070324                                                  0000001307106B                `;

    expect(parse(text)).toEqual([
      {
        amounts: {
          start: 107184.13,
          diff: 23526.49,
          end: 130710.62,
          transactions: 825.2,
        },
        header: {
          record_code: '01',
          bank_code: '17406',
          _1: '',
          desk_code: '00283',
          currency_code: 'EUR',
          nb_of_dec: '2',
          _2: '',
          account_nb: '65041564965',
          _3: '',
          prev_date: '2024-03-06',
          _4: '',
          prev_amount: '107184.13',
          _5: '047',
        },
        footer: {
          _1: '',
          _2: '',
          _3: '',
          _4: '',
          _5: '',
          record_code: '07',
          bank_code: '17406',
          desk_code: '00283',
          currency_code: 'EUR',
          nb_of_dec: '2',
          account_nb: '65041564965',
          next_date: '2024-03-07',
          next_amount: '130710.62',
        },
        transactions: [
          {
            _1: 'E',
            _2: '',
            _3: '0',
            '_4:': '',
            account_nb: '65041564965',
            amount: '825.2',
            bank_code: '17406',
            currency_code: 'EUR',
            desk_code: '00283',
            exempt_code: '1',
            internal_code: '0002',
            label: 'REMISE CHQ 6316889 RANDOM PILES',
            nb_of_dec: '2',
            operation_code: '02',
            operation_date: '2024-03-07',
            record_code: '04',
            reference: '6316889',
            reject_code: '',
            value_date: '2024-03-07',
          },
        ],
        problems: [
          {
            message:
              "Sum of transactions (825.2) doesn't match with difference between start amount 107184.13 and end amount 130710.62",
          },
        ],
      },
    ]);
  });
});

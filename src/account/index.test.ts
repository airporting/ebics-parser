import { describe, expect, test } from 'vitest';

import { accountParser } from './index';

describe('account', () => {
  test('Sycomore - no transactions', () => {
    const text = [
      `0130012    00071EUR2 00010139479  280323                                                  0000003445691I`,
      `0730012    00071EUR2 00010139479  290323                                                  0000003445691I`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sycomore 2 - no transactions', () => {
    const text = [
      `0130012    00823EUR2 00010738652  280323                                                  0000000008653O`,
      `0730012    00823EUR2 00010738652  290323                                                  0000000008653O`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Somewhere unknown example - no transactions', () => {
    const text = [
      `0130056    00917EUR2 09170295947  060921                                                  0000000008474P`,
      `0730056    00917EUR2 09170295947  070921                                                  0000000008474P                `,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sycomore 3', () => {
    const text = [
      `0130012    00585EUR2 00010156142  280323                                                  0000006564827I`,
      `0430012056800585EUR2 0001015614218290323  290323DOMUSVI                          0000000  0000000359190{`,
      `0530012056800585EUR2 0001015614218290323     NPYDOMUSVI`,
      `0530012056800585EUR2 0001015614218290323     LCC/INV/3867 8.2.2023`,
      `0530012056800585EUR2 0001015614218290323     RCNNOTPROVIDED`,
      `0530012056800585EUR2 0001015614218290323     PDOFR FRANCE`,
      `0430012081800585EUR2 00010156142B2290323  290323PRLV SEPA/DGFIP IMPOT                   0 0000000560630}FR46ZZZ005002`,
      `0530012081800585EUR2 00010156142B2290323     NBEDGFIP IMPOT`,
      `0530012081800585EUR2 00010156142B2290323     IBEFR46ZZZ005002`,
      `0530012081800585EUR2 00010156142B2290323     RUMNN804148211DGFIP2019921505K41FN7QQ`,
      `0530012081800585EUR2 00010156142B2290323     RCN220750510700113748308`,
      `0530012081800585EUR2 00010156142B2290323     LCCTVA-032023-3310CA3`,
      `0730012    00585EUR2 00010156142  290323                                                  0000006363387I`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Known bank', () => {
    const text = [
      `0118020    00001EUR2 00410GXLT01  060423                                                  0000000012258N`,
      `0418020404100001EUR2 00410GXLT0121070423  050423VIREMENT BANCAIRE EN VOTRE FAVE  3175387 00000000594363K000070`,
      `0518020404100001EUR2 00410GXLT0121070423  050423URN 5335098    VIREMENT N 53350`,
      `0418020312600001EUR2 00410GXLT0167070423  050423TVA SUR PRECOMPTE DE COMM. DE F  3175387 00000000001429P000002`,
      `0518020312600001EUR2 00410GXLT0167070423  050423INANCEMENT   VIREMENT N 5335098`,
      `0418020302600001EUR2 00410GXLT0161070423  050423PRECOMPTE DE COMM. DE FINANCEME  3175387 00000000007148N000001`,
      `0518020302600001EUR2 00410GXLT0161070423  050423NT   VIREMENT N 5335098`,
      `0418020608100001EUR2 00410GXLT0191070423  070423PRELEVEMENT DE FG 10.00P SUR RE  3173891 00000000059253P000073`,
      `0518020608100001EUR2 00410GXLT0191070423  070423MISE N 2740649`,
      `0418020608300001EUR2 00410GXLT0191070423  070423PRELEVEMENT DE FONDS DE RESERVE  3173891 00000000023701N000017`,
      `0518020608300001EUR2 00410GXLT0191070423  070423 SUR REMISE N 2740649`,
      `0418020303100001EUR2 00410GXLT0167070423  070423TVA SUR COMMISSION D AFFACTURAG  3173891 00000000000273O000003`,
      `0518020303100001EUR2 00410GXLT0167070423  070423E SUR REMISE N 2740649`,
      `0418020302100001EUR2 00410GXLT0165070423  070423COMMISSION D AFFACTURAGE SUR RE  3173891 00000000001367R000002`,
      `0518020302100001EUR2 00410GXLT0165070423  070423MISE N 2740649`,
      `0418020100100001EUR2 00410GXLT0191070423  070423ACHAT REMISE DE FACTURES  REMIS  3173891 00000000911857G000001`,
      `0518020100100001EUR2 00410GXLT0191070423  070423E N 2740649`,
      `0418020312200001EUR2 00410GXLT0167070423  070423TVA SUR COMMISSION SUR REMISE D  3173163 00000000000063N000003`,
      `0518020312200001EUR2 00410GXLT0167070423  070423 AVOIRS   REMISE N 2740651`,
      `0418020302200001EUR2 00410GXLT0165070423  070423COMMISSION SUR REMISE D AVOIRS   3173163 00000000000317N000002`,
      `0518020302200001EUR2 00410GXLT0165070423  070423 REMISE N 2740651`,
      `0418020100200001EUR2 00410GXLT0191070423  070423ACHAT REMISE D AVOIRS  REMISE N  3173163 00000000211680J000001`,
      `0518020100200001EUR2 00410GXLT0191070423  070423 2740651`,
      `0718020    00001EUR2 00410GXLT01  070423                                                  0000000000000}`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Known bank - with specific provider transactions', () => {
    const text = [
      '0118020    00001EUR2 00410GXLT11  050423                                                  0000024431270M                ',
      '0418020505100001EUR2 00410GXLT1105060423  310323VIREMENT RECU  FACTURE N 806500  3142953 00000000006000{000005          ',
      '0518020505100001EUR2 00410GXLT1105060423  31032341 LEROY MERLIN FRANCE                                                  ',
      '0418020505100001EUR2 00410GXLT1105060423  310323VIREMENT RECU  FACTURE N 806448  3142951 00000000012000{000005          ',
      '0518020505100001EUR2 00410GXLT1105060423  31032332 LEROY MERLIN FRANCE                                                  ',
      '0418020505100001EUR2 00410GXLT1105060423  310323VIREMENT RECU  FACTURE N 806471  3142949 00000000006000{000005          ',
      '0518020505100001EUR2 00410GXLT1105060423  31032340 LEROY MERLIN FRANCE                                                  ',
      '0418020505100001EUR2 00410GXLT1105060423  310323VIREMENT RECU  FACTURE N 806472  3142948 00000000006000{000005          ',
      '0518020505100001EUR2 00410GXLT1105060423  31032362 LEROY MERLIN FRANCE                                                  ',
      '0418020505100001EUR2 00410GXLT1105060423  310323VIREMENT RECU  FACTURE N 806473  3142947 00000000006000{000005          ',
      '0518020505100001EUR2 00410GXLT1105060423  31032301 LEROY MERLIN FRANCE                                                  ',
      '0718020    00001EUR2 00410GXLT11  060423                                                  0000024365270M                ',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Known bank 2', () => {
    const text = [
      `0118020    00001EUR2 00410GXLT01  030323                                                  0000000773178H`,
      `0418020404100001EUR2 00410GXLT0121060323  040323VIREMENT BANCAIRE EN VOTRE FAVE  2059801 00000000771083K000070`,
      `0518020404100001EUR2 00410GXLT0121060323  040323URN 5295341    VIREMENT N 52953`,
      `0418020312600001EUR2 00410GXLT0167060323  040323TVA SUR PRECOMPTE DE COMM. DE F  2059801 00000000000349L000002`,
      `0518020312600001EUR2 00410GXLT0167060323  040323INANCEMENT   VIREMENT N 5295341`,
      `0418020302600001EUR2 00410GXLT0161060323  040323PRECOMPTE DE COMM. DE FINANCEME  2059801 00000000001746L000001`,
      `0518020302600001EUR2 00410GXLT0161060323  040323NT   VIREMENT N 5295341`,
      `0718020    00001EUR2 00410GXLT01  060323                                                  0000000000000}`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Known bank 3 - no transactions', () => {
    const text = [
      `0118020    00001EUR2 00410GXLT01  210323                                                  0000000000000}`,
      `0718020    00001EUR2 00410GXLT01  220323                                                  0000000000000}`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Known bank 4 - no transactions', () => {
    const text = [
      `0118020    00001EUR2 00410GXLT11  210323                                                  0000019966371M`,
      `0718020    00001EUR2 00410GXLT11  220323                                                  0000019966371M                `,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sycomore 4', () => {
    const text = [
      `0130003    01678EUR2 00020086644  140423                                                  0000000472898C`,
      `0430003715001678EUR2 000200866447717042300170423CAT N  01678E2347600041          00000000 0000001800000{`,
      `0530003715001678EUR2 0002008664477170423     LIBECHU LE 17-04-2023`,
      `0430003715001678EUR2 000200866447717042300170423INTERETS CREDITEURS SUR CAT      00000000 0000000004280E`,
      `0530003715001678EUR2 0002008664477170423     LIBN 01678E2347600041`,
      `0530003715001678EUR2 0002008664477170423     LIBPERIODE DU 17/03/23 AU 17/04/23`,
      `0430003715001678EUR2 000200866447617042300170423OUVERTURE COMPTE A TERME N       00000001 0000001804280N`,
      `0530003715001678EUR2 0002008664476170423     LIB01678E2350700167 ECH 17-05-2023`,
      `0730003    01678EUR2 00020086644  170423                                                  0000000472898C`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sycomore 5', () => {
    const text = [
      `0130003    03300EUR2 00020547711  140423                                                  0000002209722A                `,
      `0430003740003300EUR2 000205477116217042300170423NTL RECU        360430885258     10485971 0000000000370}FRAIS VIR I     `,
      `0530003740003300EUR2 0002054771162170423     LIBREF 360430885258                                                        `,
      `0530003740003300EUR2 0002054771162170423     LIB  1 VIREMENT(S)          POUR  19 00                                    `,
      `0530003740003300EUR2 0002054771162170423     LIB  1 COMMISSION DE CHANGE POUR 18 00                                     `,
      `0430003432003300EUR2 00020547711B117042300170423PRELEVEMENT  METRO CASH CARRY F  50498840 0000000006041R1405049884      `,
      `0530003432003300EUR2 00020547711B1170423     NBEMETRO CASH CARRY FRANCE-METRO FRANCE`,
      `0530003432003300EUR2 00020547711B1170423     IBEFR17ZZZ452888`,
      `0530003432003300EUR2 00020547711B1170423     LCCPRELEVEMENT`,
      `0530003432003300EUR2 00020547711B1170423     RCN0109694881`,
      `0530003432003300EUR2 00020547711B1170423     RUMCMR000074241101`,
      `0730003    03300EUR2 00020547711  170423                                                  0000002203310B                C`,
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sycomore 6', () => {
    const text = [
      '0130012    00071EUR2 00010139479  130423                                                  0000003327648G                ',
      '0430012008300071EUR2 0001013947928140423  140423DU 140423 INFOMANIAK.COM CARTE   00000000 0000000000945}4974XXXXXXXX0507',
      '0530012008300071EUR2 0001013947928140423     LIB CHE 94 50EUR                                                           ',
      '0430012081300071EUR2 00010139479B1140423  140423PRLV SEPA/SOSH PRO                      0 0000000000959QFR18ZZZ531471   ',
      '0530012081300071EUR2 00010139479B1140423     NBESOSH PRO                                                                ',
      '0530012081300071EUR2 00010139479B1140423     IBEFR18ZZZ531471                                                           ',
      '0530012081300071EUR2 00010139479B1140423     LCCFACTURE SOSHPRO 02/04/2023 F202304025208                                ',
      '0530012081300071EUR2 00010139479B1140423     RCN2652682                                                                 ',
      '0530012081300071EUR2 00010139479B1140423     RUMJNRUMVISAMUNDI000000020220916142704RCUR                                 ',
      '0430012008300071EUR2 0001013947928140423  140423DU 120423 BLS*MONDAY.COM1 CARTE  00000000 0000000001428} 4974XXXXXXXX050',
      '0530012008300071EUR2 0001013947928140423     LIB7 GBR 142 80EUR                                                         ',
      '0430012056300071EUR2 00010139479C2140423  140423MIRAMUNDI                        0000000  0000000003300{SCTINSTOUTU5KIEU',
      '0530012056300071EUR2 00010139479C2140423     NPYMIRAMUNDI                                                               ',
      '0530012056300071EUR2 00010139479C2140423     LCCF20220302-018                                                           ',
      '0530012056300071EUR2 00010139479C2140423     RCNSCTINSTOUTU5KIEUSARSWUR0X3HUXBG2                                        ',
      '0430012056300071EUR2 00010139479C2140423  140423MIRAMUNDI                        0000000  0000000018000{SCTINSTOUTD7PBAP',
      '0530012056300071EUR2 00010139479C2140423     NPYMIRAMUNDI                                                               ',
      '0530012056300071EUR2 00010139479C2140423     LCCTOP2022 / 3056617/1                                                     ',
      '0530012056300071EUR2 00010139479C2140423     RCNSCTINSTOUTD7PBAPXBEPJ2JRBUWPCNW9                                        ',
      '0430012056300071EUR2 00010139479C2140423  140423MIRAMUNDI                        0000000  0000000024000{SCTINSTOUTLMQOIT',
      '0530012056300071EUR2 00010139479C2140423     NPYMIRAMUNDI                                                               ',
      '0530012056300071EUR2 00010139479C2140423     LCC120502                                                                  ',
      '0530012056300071EUR2 00010139479C2140423     RCNSCTINSTOUTLMQOITIMXOBTMJD441PR81                                        ',
      '0430012056300071EUR2 00010139479C2140423  140423MIRAMUNDI                        0000000  0000000024600{SCTINSTOUTEWOGX0',
      '0530012056300071EUR2 00010139479C2140423     NPYMIRAMUNDI                                                               ',
      '0530012056300071EUR2 00010139479C2140423     LCC120602                                                                  ',
      '0530012056300071EUR2 00010139479C2140423     RCNSCTINSTOUTEWOGX0NUZGKKWAZFVNYIW9                                        ',
      '0730012    00071EUR2 00010139479  140423                                                  0000003676615I                ',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sycomore 7 - transaction without body', () => {
    const text = [
      '0130012    00585EUR2 00010156142  130423                                                  0000008850455C                ',
      '0430012002900585EUR2 0001015614270140423  010423INTERETS ET COMMISSIONS          00000001 0000000004385N',
      '0730012    00585EUR2 00010156142  140423                                                  0000008846069H',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sycomore 8 - transactions with some extra spaces in qualifier', () => {
    const text = [
      '0130012    00760EUR2 01124412726  130423                                                  0000003152474H                ',
      '0430012002900760EUR2 0112441272670140423  010423INTERETS ET COMMISSIONS          00000001 0000000002524Q                ',
      '0430012081300760EUR2 01124412726B1140423  140423PRLV SEPA/AMENSAS                       0 0000000000119QFR91ZZZ450973   ',
      '0530012081300760EUR2 01124412726B1140423     NBEAMENSAS                                                                 ',
      '0530012081300760EUR2 01124412726B1140423     IBEFR91ZZZ450973                                                           ',
      '0530012081300760EUR2 01124412726B1140423     LCCPAYMENT ORDER 178674317                                                 ',
      '0530012081300760EUR2 01124412726B1140423     RCNKP53665-AMENORDER 178674317                                            ',
      '0530012081300760EUR2 01124412726B1140423     RUMKP78745-AMENFR-1                   RCUR                                 ',
      '0430012081300760EUR2 01124412726B1140423  140423PRLV SEPA/SOSH PRO                      0 0000000000479RFR18ZZZ531471   ',
      '0530012081300760EUR2 01124412726B1140423     NBESOSH PRO                                                                ',
      '0530012081300760EUR2 01124412726B1140423     IBEFR18ZZZ531471                                                           ',
      '0530012081300760EUR2 01124412726B1140423     LCCFACTURE SOSHPRO 02/04/2023 F202304007806                                ',
      '0530012081300760EUR2 01124412726B1140423     RCN2582434                                                                 ',
      '0530012081300760EUR2 01124412726B1140423     RUMJNRUMLAGRANDESERRE00020211007111533RCUR                                 ',
      '0430012081300760EUR2 01124412726B1140423  140423PRLV SEPA/LES JOYEUX RECYCLEURS         0 0000000000840}FR78ZZY647216   ',
      '0530012081300760EUR2 01124412726B1140423     NBELES JOYEUX RECYCLEURS                                                   ',
      '0530012081300760EUR2 01124412726B1140423     IBEFR78ZZY647216                                                           ',
      '0530012081300760EUR2 01124412726B1140423     LCCABONNEMENT 2023-04                                                      ',
      '0530012081300760EUR2 01124412726B1140423     RCNABONNEMENT 2023-04                                                      ',
      '0530012081300760EUR2 01124412726B1140423     RUMBOXDESJOYEUXRECYCLEURSC1091        RCUR                                 ',
      '0430012081300760EUR2 01124412726B1140423  140423PRLV SEPA/ORANGE SA-ORANGE              0 0000000000948}FR16ZYZ012545   ',
      '0530012081300760EUR2 01124412726B1140423     NBEORANGE SA-ORANGE                                                        ',
      '0530012081300760EUR2 01124412726B1140423     IBEFR16ZYZ012545                                                           ',
      '0530012081300760EUR2 01124412726B1140423     LCCVOTRE ABONNEMENT FIBRE (FACTURE  XXXXX3963C4) - P                       ',
      '0530012081300760EUR2 01124412726B1140423     RCN1B966E396 C765D3864C574F                                                ',
      '0530012081300760EUR2 01124412726B1140423     RUMM0063144755                        RCUR',
      '0730012    00760EUR2 01124412726  140423                                                  0000003233602C                ',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sobank', () => {
    const text = [
      '0110278    06186EUR2 00020828502  030323                                                  0000003522324E030323060323    ',
      '0410278930506186EUR2 0002082850218060323  060323VIR SAS  TACOS                   0000000 00000000002520{                ',
      '0510278930506186EUR2 0002082850218060323     LIBREMB TROP PERCUE FACT SEPT                                              ',
      '0510278930506186EUR2 0002082850218060323     NOMSAS  TACOS                         O Reilly IT                          ',
      '0510278930506186EUR2 0002082850218060323     NBEO Reilly IT                                                             ',
      '0510278930506186EUR2 0002082850218060323     NPYSAS  TACOS                                                              ',
      '0510278930506186EUR2 0002082850218060323     LCCREMB TROP PERCUE FACT SEPT                                              ',
      '0510278930506186EUR2 0002082850218060323     RCNREMB TROP PERCUE FACT SEPT                                              ',
      '0510278930506186EUR2 0002082850218060323     REFREMBOUR                                                                 ',
      '0510278930506186EUR2 0002082850218060323     CBEFR7610278061860002082850258                                             ',
      '0710278    06186EUR2 00020828502  060323                                                  0000003524844E    ',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sobank 1', () => {
    const text = [
      '0110207    00233EUR2 32418565371  060323                                                  0000000235185H                ',
      '0410207053700233EUR2E3241856537108070323  070323EUROPRELEVEMENT                  01P71OB100000000000561OAPPS COMMERCE   ',
      '0510207053700233EUR2E3241856537108070323     LIBAPPS COMMERCE PICKR.FR GG10340DH                                        ',
      '0510207053700233EUR2E3241856537108070323     LIB71626833                                                                ',
      '0510207053700233EUR2E3241856537108070323     LIBPRLV SEPA GOOGLE CLOUD F                                                ',
      '0710207    00233EUR2 32418565371  070323                                                  0000000234624B                ',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sobank 2 - no transactions', () => {
    const text = [
      '0110207    00233EUR2 24218653792  030323                                                  0000000235185H                ',
      '0710207    00233EUR2 24218653792  060323                                                  0000000235185H        ',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });

  test('Sobank 3 - should find internal code from transaction body', () => {
    const text = [
      '0110279    01084EUR2 00023107391  080424                                                  0000002527769I080324120324    ',
      '0410279916201084EUR2 00023107391B1110424  110324PRLV SEPA Kreiger - Inc MARKETI  0000010000000000003039M',
      '0510279    01084EUR2 00023107391B1110424     LIB/INV/F4813768/0086247287 //2023                                         ',
      '0710279    01084EUR2 00023107391  110424                                                  0000002524730E                ',
    ];

    expect(accountParser(text)).toMatchSnapshot();
  });
});
